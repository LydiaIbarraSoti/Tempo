<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    
    <!-- <script crossorigin="anonymous" src="https://connect.facebook.net/es_LA/sdk.js#xfbml=1&version=v13.0&appId=725249845183911&autoLogAppEvents=1" nonce="F0h4wk7o"></script> -->
    <script src="https://connect.facebook.net/en_US/sdk.js?hash=bc8156502a62666edec21040e16a88e1" async="" crossorigin="anonymous"></script><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
    <link rel="icon" href="https://parvadacv.mx/wp-content/uploads/2019/07/icono.png">
    <link rel="stylesheet" href="https://boletos.vinosparvada.com/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://boletos.vinosparvada.com/assets/css/stepper.css">
    <link rel="stylesheet" href="https://boletos.vinosparvada.com/assets/css/modalAnimacion.css">
    <link rel="stylesheet" href="https://boletos.vinosparvada.com/assets/css/disenoPago.css">
    <link rel="stylesheet" href="https://boletos.vinosparvada.com/assets/css/disenoTablas.css">
    <script src="https://boletos.vinosparvada.com/assets/js/qr-code-styling.js"></script>
    <script src="https://boletos.vinosparvada.com/assets/js/qr-code-styling.js.map"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kaushan+Script">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://boletos.vinosparvada.com/assets/fonts/font-awesome.min.css">
    
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.0/css/dataTables.bootstrap5.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.12.0/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.12.0/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async="" defer=""></script>
    <script type="text/javascript" src="https://js.openpay.mx/openpay.v1.min.js"></script>
    <script type="text/javascript" src="https://js.openpay.mx/openpay-data.v1.min.js"></script>
    <script type="text/javascript" src="https://pay.conekta.com/v1.0/js/conekta-checkout.min.js"></script><style id="googleidentityservice_button_styles">.qJTHM{-webkit-user-select:none;color:#202124;direction:ltr;-webkit-touch-callout:none;font-family:"Roboto-Regular",arial,sans-serif;-webkit-font-smoothing:antialiased;font-weight:400;margin:0;overflow:hidden;-webkit-text-size-adjust:100%}.ynRLnc{left:-9999px;position:absolute;top:-9999px}.L6cTce{display:none}.bltWBb{word-break:break-all}.hSRGPd{color:#1a73e8;cursor:pointer;font-weight:500;text-decoration:none}.Bz112c-W3lGp{height:16px;width:16px}.Bz112c-E3DyYd{height:20px;width:20px}.Bz112c-r9oPif{height:24px;width:24px}.Bz112c-uaxL4e{-webkit-border-radius:10px;border-radius:10px}.LgbsSe-Bz112c{display:block}.S9gUrf-YoZ4jf,.S9gUrf-YoZ4jf *{border:none;margin:0;padding:0}.fFW7wc-ibnC6b>.aZ2wEe>div{border-color:#4285f4}.P1ekSe-ZMv3u>div:nth-child(1){background-color:#1a73e8!important}.P1ekSe-ZMv3u>div:nth-child(2),.P1ekSe-ZMv3u>div:nth-child(3){background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.haAclf{display:inline-block}.nsm7Bb-HzV7m-LgbsSe{-webkit-border-radius:4px;border-radius:4px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-transition:background-color .218s,border-color .218s;transition:background-color .218s,border-color .218s;-webkit-user-select:none;-webkit-appearance:none;background-color:#fff;background-image:none;border:1px solid #dadce0;color:#3c4043;cursor:pointer;font-family:"Google Sans",arial,sans-serif;font-size:14px;height:40px;letter-spacing:0.25px;outline:none;overflow:hidden;padding:0 12px;position:relative;text-align:center;vertical-align:middle;white-space:nowrap;width:auto}@media screen and (-ms-high-contrast:active){.nsm7Bb-HzV7m-LgbsSe{border:2px solid windowText;color:windowText}}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe{font-size:14px;height:32px;letter-spacing:0.25px;padding:0 10px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe{font-size:11px;height:20px;letter-spacing:0.3px;padding:0 8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe{padding:0;width:40px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe{width:32px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe{width:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK{-webkit-border-radius:20px;border-radius:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.pSzOP-SxQuSe{-webkit-border-radius:16px;border-radius:16px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.purZT-SxQuSe{-webkit-border-radius:10px;border-radius:10px}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc{border:none;color:#fff}.nsm7Bb-HzV7m-LgbsSe.MFS4be-v3pZbf-Ia7Qfc{background-color:#1a73e8}.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{background-color:#202124;color:#e8eaed}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:18px;margin-right:8px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:14px;min-width:14px;width:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:10px;min-width:10px;width:10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin-left:8px;margin-right:-4px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:10px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:4px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-top-left-radius:3px;border-top-left-radius:3px;-webkit-border-bottom-left-radius:3px;border-bottom-left-radius:3px;display:-webkit-box;display:-webkit-flex;display:flex;justify-content:center;-webkit-align-items:center;align-items:center;background-color:#fff;height:36px;margin-left:-10px;margin-right:12px;min-width:36px;width:36px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c,.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:28px;margin-left:-8px;margin-right:10px;min-width:28px;width:28px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:16px;margin-left:-6px;margin-right:8px;min-width:16px;width:16px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-radius:3px;border-radius:3px;margin-left:2px;margin-right:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-radius:18px;border-radius:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-radius:14px;border-radius:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-radius:8px;border-radius:8px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-bN97Pc-sM5MNb{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-flex-direction:row;flex-direction:row;justify-content:space-between;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;height:100%;position:relative;width:100%}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX{justify-content:center}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{-webkit-flex-grow:1;flex-grow:1;font-family:"Google Sans",arial,sans-serif;font-weight:500;overflow:hidden;text-overflow:ellipsis;vertical-align:top}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-weight:300}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX .nsm7Bb-HzV7m-LgbsSe-BPrWId{-webkit-flex-grow:0;flex-grow:0}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-MJoBVe{-webkit-transition:background-color .218s;transition:background-color .218s;bottom:0;left:0;position:absolute;right:0;top:0}.nsm7Bb-HzV7m-LgbsSe:hover,.nsm7Bb-HzV7m-LgbsSe:focus{-webkit-box-shadow:none;box-shadow:none;border-color:#d2e3fc;outline:none}.nsm7Bb-HzV7m-LgbsSe:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.04)}.nsm7Bb-HzV7m-LgbsSe:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.1)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.24)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.32)}.nsm7Bb-HzV7m-LgbsSe .n1UuX-DkfjY{-webkit-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:flex;height:20px;margin-left:-4px;margin-right:8px;min-width:20px;width:20px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-family:"Roboto";font-size:12px;text-align:left}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .ssJRIf,.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .fmcmS{overflow:hidden;text-overflow:ellipsis}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;color:#5f6368;fill:#5f6368;font-size:11px;font-weight:400}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#e8eaed;fill:#e8eaed}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .Bz112c{height:18px;margin:-3px -3px -3px 2px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-top-left-radius:0;border-top-left-radius:0;-webkit-border-bottom-left-radius:0;border-bottom-left-radius:0;-webkit-border-top-right-radius:3px;border-top-right-radius:3px;-webkit-border-bottom-right-radius:3px;border-bottom-right-radius:3px;margin-left:12px;margin-right:-10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-radius:18px;border-radius:18px}.L5Fo6c-sM5MNb{border:0;display:block;left:0;position:relative;top:0}.L5Fo6c-bF1uUb{-webkit-border-radius:4px;border-radius:4px;bottom:0;cursor:pointer;left:0;position:absolute;right:0;top:0}.L5Fo6c-bF1uUb:focus{border:none;outline:none}sentinel{}</style>
    <script async="" defer="" crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
    
    <link href="assets/css/style.css" rel="stylesheet">
        <link href="assets/css/cargando.css" rel="stylesheet">
        <link href="assets/css/diseñoPago.css" rel="stylesheet">
        <link href="assets/css/modalAnimacion.css" rel="stylesheet">
        <link href="assets/css/disenoTablas.css" rel="stylesheet">
        <script src="registro/registro.js"></script> 

        <header id="header" class="fixed-top ">
                <div class="container d-flex align-items-center justify-content-between" style="padding: 10px 30px 10;">                
                <a class="logo" ><img src="assets/img/WEB_APP/Logo/vido.png" alt="" class="img-fluid"></a>
                <nav id="navbar" class="navbar">
                    <ul>
                    <li><a class="nav-link scrollto active" href="index.php">Inicio</a></li>                    
                    <li><a class="nav-link scrollto" href="registro.php">Registro</a></li>  
                    <li><a class="nav-link scrollto" href="pago.php">Openpay</a></li>
                    <li><a class="nav-link scrollto" href="coneckta.php">Conekta</a></li>
                    </ul>
                    <i class="bi bi-list mobile-nav-toggle"></i>
                </nav><!-- .navbar -->
                </div>
            </header><!-- End Header -->
    

<link id="googleidentityservice" type="text/css" media="all" rel="stylesheet" href="https://accounts.google.com/gsi/style"><style type="text/css" data-fbcssmodules="css:fb.css.base css:fb.css.dialog css:fb.css.iframewidget css:fb.css.customer_chat_plugin_iframe">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:'lucida grande', tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:'lucida grande', tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_dialog_advanced{border-radius:8px;padding:10px}.fb_dialog_content{background:#fff;color:#373737}.fb_dialog_close_icon{background:url(https://connect.facebook.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{left:5px;right:auto;top:5px}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://connect.facebook.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://connect.facebook.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://connect.facebook.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{height:100%;left:0;margin:0;overflow:visible;position:absolute;top:-10000px;transform:none;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://connect.facebook.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{background:none;height:auto;min-height:initial;min-width:initial;width:auto}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{clear:both;color:#fff;display:block;font-size:18px;padding-top:20px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .4);bottom:0;left:0;min-height:100%;position:absolute;right:0;top:0;width:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_mobile .fb_dialog_iframe{position:sticky;top:0}.fb_dialog_content .dialog_header{background:linear-gradient(from(#738aba), to(#2c4987));border-bottom:1px solid;border-color:#043b87;box-shadow:white 0 1px 1px -1px inset;color:#fff;font:bold 14px Helvetica, sans-serif;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:linear-gradient(from(#4267B2), to(#2a4887));background-clip:padding-box;border:1px solid #29487d;border-radius:3px;display:inline-block;line-height:18px;margin-top:3px;max-width:85px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{background:none;border:none;color:#fff;font:bold 12px Helvetica, sans-serif;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://connect.facebook.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #4a4a4a;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f5f6f7;border:1px solid #4a4a4a;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://connect.facebook.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-position:50% 50%;background-repeat:no-repeat;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}
.fb_mpn_mobile_landing_page_slide_out{animation-duration:200ms;animation-name:fb_mpn_landing_page_slide_out;transition-timing-function:ease-in}.fb_mpn_mobile_landing_page_slide_out_from_left{animation-duration:200ms;animation-name:fb_mpn_landing_page_slide_out_from_left;transition-timing-function:ease-in}.fb_mpn_mobile_landing_page_slide_up{animation-duration:500ms;animation-name:fb_mpn_landing_page_slide_up;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_in{animation-duration:300ms;animation-name:fb_mpn_bounce_in;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_out{animation-duration:300ms;animation-name:fb_mpn_bounce_out;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_out_v2{animation-duration:300ms;animation-name:fb_mpn_fade_out;transition-timing-function:ease-in}.fb_customer_chat_bounce_in_v2{animation-duration:300ms;animation-name:fb_bounce_in_v2;transition-timing-function:ease-in}.fb_customer_chat_bounce_in_from_left{animation-duration:300ms;animation-name:fb_bounce_in_from_left;transition-timing-function:ease-in}.fb_customer_chat_bounce_out_v2{animation-duration:300ms;animation-name:fb_bounce_out_v2;transition-timing-function:ease-in}.fb_customer_chat_bounce_out_from_left{animation-duration:300ms;animation-name:fb_bounce_out_from_left;transition-timing-function:ease-in}.fb_invisible_flow{display:inherit;height:0;overflow-x:hidden;width:0}@keyframes fb_mpn_landing_page_slide_out{0%{margin:0 12px;width:100% - 24px}60%{border-radius:18px}100%{border-radius:50%;margin:0 24px;width:60px}}@keyframes fb_mpn_landing_page_slide_out_from_left{0%{left:12px;width:100% - 24px}60%{border-radius:18px}100%{border-radius:50%;left:12px;width:60px}}@keyframes fb_mpn_landing_page_slide_up{0%{bottom:0;opacity:0}100%{bottom:24px;opacity:1}}@keyframes fb_mpn_bounce_in{0%{opacity:.5;top:100%}100%{opacity:1;top:0}}@keyframes fb_mpn_fade_out{0%{bottom:30px;opacity:1}100%{bottom:0;opacity:0}}@keyframes fb_mpn_bounce_out{0%{opacity:1;top:0}100%{opacity:.5;top:100%}}@keyframes fb_bounce_in_v2{0%{opacity:0;transform:scale(0, 0);transform-origin:bottom right}50%{transform:scale(1.03, 1.03);transform-origin:bottom right}100%{opacity:1;transform:scale(1, 1);transform-origin:bottom right}}@keyframes fb_bounce_in_from_left{0%{opacity:0;transform:scale(0, 0);transform-origin:bottom left}50%{transform:scale(1.03, 1.03);transform-origin:bottom left}100%{opacity:1;transform:scale(1, 1);transform-origin:bottom left}}@keyframes fb_bounce_out_v2{0%{opacity:1;transform:scale(1, 1);transform-origin:bottom right}100%{opacity:0;transform:scale(0, 0);transform-origin:bottom right}}@keyframes fb_bounce_out_from_left{0%{opacity:1;transform:scale(1, 1);transform-origin:bottom left}100%{opacity:0;transform:scale(0, 0);transform-origin:bottom left}}@keyframes slideInFromBottom{0%{opacity:.1;transform:translateY(100%)}100%{opacity:1;transform:translateY(0)}}@keyframes slideInFromBottomDelay{0%{opacity:0;transform:translateY(100%)}97%{opacity:0;transform:translateY(100%)}100%{opacity:1;transform:translateY(0)}}</style></head>

<body id="page-top" data-bs-spy="scroll" data-bs-target="#mainNav" data-bs-offset="54" style="">

    <div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; width: 0px; height: 0px;"><div></div></div></div>
    <div id="prueba"></div>

    
 <!-- MODAL INICIO SESION -->
<!-- <div class="modal fade" id="modalIniciarSesiones" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Selecciona cómo iniciar sesión en Vinícola Parvada: </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div> -->

      <!-- <div class="modal-body w-100" style="text-align: center;"> -->

       
        <!-- <div class="container" style="align-self: center"> -->
            <!-- <div class="d-flex border rounded my-2 mouse login-carta" onclick="redirect()">
                <div class="my-2" style="width: 20%; text-align: center;">
                    <img src="https://parvadacv.mx/wp-content/uploads/2019/07/icono.png" class="img-fluid my-2" style="max-width: 50%;height:auto;"></img> 
                </div>
                <div class="my-2" style="width: 80%;">Iniciar Sesion como Administrador.</div>
            </div> -->

            <!-- <div class="d-flex border rounded my-2 mouse login-carta" onclick="iniciarSesionFB()" style="width: 420px; height: 44px;">
                <div class="my-2" style="width: 20%; height: 44px; text-align: center;">
                    <img src="https://boletos.vinosparvada.com/assets/img/Facebook_Logo_%282019%29.png" class="img-fluid my-2" style="max-width: 50%;max-height:70%; image-rendering: -webkit-optimize-contrast;"></img> 
                </div> 

                <div class="my-2" style="width: 80%;">Acceder con Facebook.</div>
            </div> -->

            <!--<div class="justify-content-center align-items-center" style="text-align: center;">
                <h6 style="text-align: center;">
                    Por mantenimiento, por favor reserva al número <a href="tel:+528717272410">8717272410</a>
                </h6>
            </div> -->

            <!-- <br>
            <div class="d-flex border rounded my-2 mouse login-carta" style="width: 420px; border-width: 0px;"> -->
                <!-- <div style="width: 100%; text-align: center;"> -->
                    <!-- <div id="g_id_onload"
                        data-client_id="317692906885-ieoq0g1m74t4koql96sj6ttunq7rrprt.apps.googleusercontent.com"
                        data-context="signin"
                        data-ux_mode="popup"
                        data-callback="handleCredentialResponse"
                        data-auto_prompt="false"
                        style="heigh:72px;">
                    </div> -->

                    <!-- <div class="g_id_signin"
                        data-width="440"
                        data-longtitle="true"
                        data-type="standard"
                        data-shape="rectangular"
                        data-theme="outline"
                        data-text="$ {button.text}"
                        data-size="large"
                        data-logo_alignment="center">
                    </div> -->
                    <!-- <div class="g_id_signin"
                        data-width="420"
                        data-heigh="72"
                        data-longtitle="true"
                        data-type="standard"
                        data-shape="rectangular"
                        data-theme="outline"
                        data-text="$ {button.text}"
                        data-logo_alignment="center"
                        style="width:100%; heigh: 72px; text-align: center;">
                    </div> -->
                <!-- </div> -->
                
                <!-- <div id="g_id_onload" data-client_id="482221707243-da5bp0h7kt4461qp5kgd0t854sd4pp3p.apps.googleusercontent.com" 
                data-context="signin" data-ux_mode="popup" data-callback="handleCredentialResponse" data-login_uri="https://boletos.vinosparvada.com/" data-auto_prompt="false">
                </div>                
                <div class="g_id_signin" data-type="standard" data-shape="rectangular" data-theme="outline" data-text="signin_with" data-size="large" data-logo_alignment="left"
                 data-width="430"><div class="S9gUrf-YoZ4jf" style="position: relative;"><div><div tabindex="0" role="button" aria-labelledby="button-label" 
                 class="nsm7Bb-HzV7m-LgbsSe  hJDwNd-SxQuSe i5vt6e-Ia7Qfc uaxL4e-RbRzK" style="width:430px; max-width:400px; min-width:min-content;">
                 <div class="nsm7Bb-HzV7m-LgbsSe-MJoBVe"></div><div class="nsm7Bb-HzV7m-LgbsSe-bN97Pc-sM5MNb "><div class="nsm7Bb-HzV7m-LgbsSe-Bz112c">
                  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" class="LgbsSe-Bz112c"><g>
                    <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z">

                    </path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z">

                    </path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z">

                    </path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z">

                    </path><path fill="none" d="M0 0h48v48H0z"></path></g></svg></div><span class="nsm7Bb-HzV7m-LgbsSe-BPrWId">Sign in with Google</span>
                    <span class="L6cTce" id="button-label">Sign in with Google</span></div></div></div>
                    <iframe src="https://accounts.google.com/gsi/button?type=standard&amp;shape=rectangular&amp;theme=outline&amp;text=signin_with&amp;size=large&amp;logo_alignment=left&amp;width=430&amp;client_id=482221707243-da5bp0h7kt4461qp5kgd0t854sd4pp3p.apps.googleusercontent.com&amp;iframe_id=gsi_652428_972957&amp;as=okpRcfWFiqB1U4NJSwQMJQ" 
                    allow="identity-credentials-get" id="gsi_652428_972957" title="Sign in with Google Button" style="display: block; position: relative; top: 0px; left: 0px; height: 0px; width: 0px; border: 0px;"></iframe></div></div>
                
                <div id="btnGoogle" style="width: 80%; padding-left: 10px;"></div>
            </div>
        </div>
        
      </div>

      <div class="modal-footer justify-content-around">
        <button type="button" class="btn btn-outline-secondary btn-cerrar-modal-sesiones" data-bs-dismiss="modal">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>     -->
<!-- FIN MODAL INICIO SESION -->

<!-- TOAST MENSAJES -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  <div id="liveToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <!-- <img src="..." class="rounded me-2" alt="..."> -->
      <img src="https://boletos.vinosparvada.com/assets/img/imagenQR.png" class="me-2" alt="logo" width="20" height="20">
      <strong class="me-auto" id="toast-titulo"></strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body fw-bold">
    </div>
  </div>

</div>

      <!-- <nav class="navbar navbar-light navbar-expand-lg fixed-top bg-light" id="mainNav">
        <div class="container">
            <a class="navbar-brand" href="https://boletos.vinosparvada.com"><img src="https://boletos.vinosparvada.com/assets/img/logos/logoBarra.png" alt=""></a>
            <button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler navbar-toggler-right collapsed" type="button" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto text-uppercase">
                    <li class="nav-item"><a class="nav-link textoBarra" href="https://boletos.vinosparvada.com"> Inicio </a></li>
                    <li class="nav-item"><a class="nav-link textoBarra" href="https://boletos.vinosparvada.com/usuarios/misEventos"> Mis Eventos </a></li>
                    <li class="nav-item"><a class="nav-link textoBarra" href="https://boletos.vinosparvada.com/usuarios/verFacturas"> Facturas </a></li>
                    <li class="nav-item" id="linkSesion"><a class="nav-link textoBarra" id="linkModalSesion" onclick="mostrarModalSesiones()">Iniciar sesion</a></li>
                        
                </ul>
            </div>
        </div>
    </nav> -->

    <script>
    let sesionIniciadaFB = false;
    let sesionIniciadaGoogle = false;
    let datosSesion = '';
    let sesionIniciadaPHP = false;
    
    
    /*window.onload = function () {
          google.accounts.id.initialize({
            //client_id: "317692906885-ieoq0g1m74t4koql96sj6ttunq7rrprt.apps.googleusercontent.com",
            client_id: "482221707243-da5bp0h7kt4461qp5kgd0t854sd4pp3p.apps.googleusercontent.com",
            //client_id: "482221707243-inanapkfrhkk91kom5usd71s4h84ctn8.apps.googleusercontent.com",
            callback: handleCredentialResponse
          });
          google.accounts.id.renderButton(
            document.getElementById("btnGoogle"),
            { theme: "outline", size: "large", width: "500"}  // customization attributes
          );
          //google.accounts.id.prompt(); // also display the One Tap dialog
    }*/

    function redirect(){
        let url = 'https://boletos.vinosparvada.com/login';
        window.location.href = url;
    }

    // function mostrarOpcionesSesion(){
    //     sesionIniciadaGoogle = '';
    //     sesionIniciadaFB = '';
    //     sesionIniciadaPHP = '';

    //     if (sesionIniciadaFB){
    //         console.log("Sesion iniciada facebook");
    //         $("#linkSesion").empty()
    //         $("#linkSesion").append(`<a class="nav-link textoBarra" id="linkModalSesion" onclick="cerrarSesionFB()">Cerrar sesion</a>`);
    //     }
    //     else if (sesionIniciadaGoogle ){
    //         console.log("Sesion iniciada google");
    //         $("#linkSesion").empty()
    //         $("#linkSesion").append(`<a class="nav-link textoBarra" id="linkModalSesion" onclick="cerrarSesionGoogle()">Cerrar sesion</a>`);
    //     }
    //     else if(sesionIniciadaGoogle == false && sesionIniciadaFB == false){
    //         console.log("Sin sesion iniciada");
    //         $("#linkSesion").empty()
    //         $("#linkSesion").append(`<a class="nav-link textoBarra" id="linkModalSesion" onclick="mostrarModalSesiones()">Iniciar sesion</a>`);
    //     }
    //     else if(sesionIniciadaPHP == false){
    //         $("#linkSesion").empty()
    //         $("#linkSesion").append(`<a class="nav-link textoBarra" id="linkModalSesion" onclick="mostrarModalSesiones()">Iniciar sesion</a>`);
    //     }
    // }

    function cerrarSesionGoogle(){
        //Google ya no controla el estado de la sesión, así que sólo cerramos sesión en la app
        cerrarSesionPHP()
        .then(()=>{
            location.reload();
        })
        .catch(()=>{
            location.reload();
        });
    }

    window.fbAsyncInit = function() { // CUANDO CARGA EL SCRIPT (RECARGAR LA PAGINA)
        FB.init({
            appId      : '725249845183911',
            cookie     : true,
            xfbml      : true,
            status     : true,
            version    : 'v13.0'
        });
        
        FB.AppEvents.logPageView();   
        
        FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
            console.log("Inicio response Facebook fbAsync");
            console.log(response);
            console.log("Fin response Facebook fbAsync");
        });
    };

    // ---------------------------------------------------------------------
    function statusChangeCallback(response) {  // Called with the results from FB.getLoginStatus().
            // console.log('statusChangeCallback');
            // console.log(response);                   // The current login status of the person.
            if (response.status === 'connected') {   // Logged into your webpage and Facebook.
                
                sesionIniciadaFB = true;
                testAPI();  
                mostrarOpcionesSesion();
                
            } else {                                 // Not logged into your webpage or we are unable to tell.
                mostrarOpcionesSesion();
            }
            
    }

    // ---------------------------------------------------------------------
    function testAPI() {                      // Testing Graph API after login.  See statusChangeCallback() for when this call is made.
        console.log('Welcome!  Fetching your information.... ');
        FB.api('/me', {fields: 'first_name,last_name,email,picture'}, function(response) {
        //console.log(response);
        datosSesion = response;
        // console.log('Successful login for: ' + response.name);
        // document.getElementById('prueba').innerHTML =
        //     'Thanks for logging in, ' + response.name + '!';
        });
    }
    
    // ---------------------------------------------------------------------
    // function cerrarSesionFB(){
    //     FB.getLoginStatus(function(response) {
    //         if(response.status === 'connected' ){

    //             FB.logout();
    //             cerrarSesionPHP()
    //             .then(()=>{
    //                 location.reload();
    //             })
    //             .catch(()=>{
    //                 location.reload();
    //             });
    //         }
    //     });
    // }
    
    // ---------------------------------------------------------------------
    function iniciarSesionFB(){ //BOTON INICAR SESION
        FB.login(function(response) {
            if (response.authResponse) {
                //console.log('Welcome!  Fetching your information.... ');
                FB.api('/me',{fields: 'first_name,last_name,email,picture'}, function(responseFB) {
                    sesionIniciadaFB = true;
                    //console.log("respuesta del login", response);
                    //console.log('Good to see you, ' + response.first_name + '.');
                    
                    datosSesion = responseFB;
                    crearCliente( responseFB, '' );
                    mostrarOpcionesSesion();
                    setTimeout(() => {

                        iniciarSesionFBGLPHP( responseFB.id, '' );
                        cerrarModalSesiones();
                        
                        
                    }, 5000);
                });
            } else {
                mostrarOpcionesSesion();
                //console.log('User cancelled login or did not fully authorize.');
            }
        }, {scope: 'email'});
    }

    //este handler cambia por una función en el HOST
    window.handleCredentialResponse = (response) => {
        //console.log("Encoded JWT ID token: " + response.credential);
        //console.log("Antes de decodificar");
        const responsePayload = decodeJwtResponse(response.credential);

        console.log(responsePayload);

        if(responsePayload.sub != "" && responsePayload.sub != null )
        {
            sesionIniciadaGoogle = true;
            //datosSesion = responsePayload;
            console.log("Antes de datossesion");
            let printedObject = JSON.stringify(datosSesion);
            console.log(printedObject);
            console.log("Despues de datossesion");
            //datosSesion = printedObject;
            //console.log("Printed Object");
            //console.log(datosSesion);
            crearCliente( '' , responsePayload );
            //mostrarOpcionesSesion();
            setTimeout(() => {

                iniciarSesionFBGLPHP( '', responsePayload.sub );
                cerrarModalSesiones();
                mostrarOpcionesSesion();

            }, 2000);
            // iniciarSesionFBGLPHP( '', responsePayload.sub );
            // console.log("Cerrar modal sesiones google");
            // console.log("ID: " + responsePayload.sub);
            // console.log('Full Name: ' + responsePayload.name);
            // console.log('Given Name: ' + responsePayload.given_name);
            // console.log('Family Name: ' + responsePayload.family_name);
            // console.log("Image URL: " + responsePayload.picture);
            // console.log("Email: " + responsePayload.email);
            // cerrarModalSesiones();
        }
    }

    // ---------------------------------------------------------------------
    function crearCliente( responseFB, responsePayload ){

        let ruta = "https://boletos.vinosparvada.com/Clientes/registrarCliente";

        let id_usuario_google = "";
        let id_usuario_facebook = "";
        let nombre_usuario = "";
        let apellido_usuario = "";
        let correo_usuario = "";
        let datos_cliente = {};

        console.log("Crear cliente");
        console.log("Facebook "+responseFB);
        console.log("Google "+responsePayload);

        if(sesionIniciadaFB)
        {
            console.log("Entré al IF de Face");
            id_usuario_facebook = responseFB.id || "";
            nombre_usuario = responseFB.first_name || "";
            apellido_usuario = responseFB.last_name || "";
            correo_usuario = responseFB.email || "";

            datos_cliente = {
            METODO_LOGIN     : "FB",
            ID_FB_CLIENTE    : id_usuario_facebook,
            ID_GOOGLE_CLIENTE : "",
            NOMBRE_CLIENTE   : nombre_usuario,
            APELLIDO_CLIENTE : apellido_usuario,
            CORREO_CLIENTE   : correo_usuario
            };
        }

        if(sesionIniciadaGoogle)
        {
            // console.log("Datos desde crear cliente");
            // console.log("ID: " + responsePayload.sub);
            // console.log('Full Name: ' + responsePayload.name);
            // console.log('Given Name: ' + responsePayload.given_name);
            // console.log('Family Name: ' + responsePayload.family_name);
            // console.log("Image URL: " + responsePayload.picture);
            // console.log("Email: " + responsePayload.email);
            console.log("Entré al if de Google");
            id_usuario_google = responsePayload.sub;
            nombre_usuario = responsePayload.given_name || "";
            apellido_usuario = responsePayload.family_name || "";
            correo_usuario = responsePayload.email || "";

            datos_cliente = {
            METODO_LOGIN     : "G",
            ID_FB_CLIENTE    : "",
            ID_GOOGLE_CLIENTE : id_usuario_google,
            NOMBRE_CLIENTE   : nombre_usuario,
            APELLIDO_CLIENTE : apellido_usuario,
            CORREO_CLIENTE   : correo_usuario
            };
        }

        // CREAR CLIENTE CON FACEBOOK O GOOGLE
        $.ajax({
            url:  ruta,
            type: "POST",
            data: datos_cliente,
            success: function( respuesta ){
                console.log(respuesta);
                let estatus = respuesta.ESTATUS || 'ERROR';
                
                if (estatus == 'OK' || estatus == 'EXISTE') {
                    // iniciarSesionFBGLPHP( id_usuario_facebook );
                    let nombre_completo = nombre_usuario +' '+ apellido_usuario;
                    let tituloToast = "Sesión";
                    let mensajeToast = `Sesión iniciada, ¡Bienvenido, ${nombre_completo}!`;
                    mostrarToast( tituloToast, mensajeToast );

                } else {
                    //cerrarSesionFB();
                    cerrarSesionGoogle();
                }
            },
            error: function(){
                // ERROR DE CONEXION AL BACKEND
                //cerrarSesionFB();
                cerrarSesionGoogle();
            },
        });
    }

    // ---------------------------------------------------------------------
                                    //Parámetros: Facebook, Google / Se reciben parámetros de acuerdo al seleccionado, el otro llega vacío
    function iniciarSesionFBGLPHP( id_usuario_fb, id_usuario_google ){
        let ruta = "https://boletos.vinosparvada.com/Clientes/iniciarCliente";

         // CREAR CLIENTE CON FACEBOOK
         $.ajax({
            url:  ruta,
            type: "POST",
            data: { ID_FACEBOOK: id_usuario_fb,
                    ID_GOOGLE: id_usuario_google }, // parametro de la funcion
            success: function( respuesta ){
                let estatus = respuesta.ESTATUS || 'ERROR';
                
                location.reload();            },
            error: function(){
                // ERROR DE CONEXION AL BACKEND
                //cerrarSesionFB();
            },
        });
    }

    //----------------------------------------------------------------------------

    // function onSignIn(googleUser) {
    //     var profile = googleUser.getBasicProfile();
    //     console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
    //     console.log('Name: ' + profile.getName());
    //     console.log('Image URL: ' + profile.getImageUrl());
    //     console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
    // }

    // function signOut() {
    //     var auth2 = gapi.auth2.getAuthInstance();
    //     auth2.signOut().then(function () {
    //     console.log('User signed out.');
    //     });
    // }

    // function handleCredentialResponse(response) {
    //       console.log("Encoded JWT ID token: " + response.credential);
    //     }
    //     window.onload = function () {
    //       google.accounts.id.initialize({
    //         client_id: "YOUR_GOOGLE_CLIENT_ID",
    //         callback: handleCredentialResponse
    //       });
    //       google.accounts.id.renderButton(
    //         document.getElementById("buttonDiv"),
    //         { theme: "outline", size: "large" }  // customization attributes
    //       );
    //       google.accounts.id.prompt(); // also display the One Tap dialog
    //     }

    // checarURL();
    // ---------------------------------------------------------------------
    // function checarURL(){
    //     console.log(window.location.toString());
    //     if( !window.location.toString().includes("https") ){
    //         window.location.href = window.location.toString().split("http").join("https");
    //     }
    // }
    // ---------------------------------------------------------------------

    // ---------------------------------------------------------------------------
    function mostrarToast( titulo, mensaje ){
        // let liveToast = document.getElementById('liveToast')
        // let myToast = bootstrap.Toast.getInstance(liveToast) // Returns a Bootstrap toast instance
        // myToast.show()
        // console.log("entro a toast");
        $("#toast-titulo").empty();
        $("#toast-titulo").append( titulo );
        $(".toast-body").empty();
        $(".toast-body").append( mensaje );

        $(".toast").toast('show');
    }

    // ---------------------------------------------------------------------
    // function mostrarModalSesiones(){
    //     let modalSesiones = new bootstrap.Modal( document.getElementById('modalIniciarSesiones'), {} );
    //     modalSesiones.show();
    // }

    // ---------------------------------------------------------------------
    // function cerrarModalSesiones(){
    //     $(".btn-cerrar-modal-sesiones").click();
    // }

    // ---------------------------------------------------------------------
    function cerrarSesionPHP()
    {
        return new Promise( ( resolve, reject ) =>{            

            let ruta = "https://boletos.vinosparvada.com/Usuarios/cerrarSesionPHP";
    
            $.ajax({
                url:ruta,
                type:"GET",
                success: function( data ){

                    FB.getLoginStatus(function(response) {
                        if(response.status === 'connected' ){
                            FB.logout();
                            //console.log("CERRANDO SESION FACEBOOK");
                            sesionIniciadaFB = false;                            
                        }
                    });

                    resolve("ok");
                    //location.reload();
                },
                error: function(){
                    reject("error");
                    location.reload();
                    // window.location.href = "https://boletos.vinosparvada.com";
    
                },
    
            });
        });
    }

    function decodeJwtResponse (token) {
        console.log("Entro a decode");
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
    
        return JSON.parse(jsonPayload);
    }

    // function checkLoginState() {
    //     FB.getLoginStatus(function(response) {
    //         statusChangeCallback(response);
    //     });
    // }

    // modalIniciarSesiones

/*(function(d, s, id){
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement(s); js.id = id;
    js.src = "https://connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));*/

    
    </script>
    

    <style>
        html{
            font-family: "Montserrat","Helvetica Neue",Helvetica,Arial,sans-serif!important;
            letter-spacing: 1px;
        }

        a {
            color: #8ab4f8;
            text-decoration: none;
        }

        .sinBordes{
            border: none;
        }

        .btn-primary {
            color: #fff;
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .textoBarra{
            color: black!important;
            font-size: 16px!important;
            cursor:pointer;
            
        }
        .textoBarra:hover{
            color: #9b6a28!important;
        }

        ::selection{
            background: rgb(37, 131, 255);
            color: white;
        }

        .bg-color{
            background-color: #e8ecef;
        }

        .login-carta{
            cursor: pointer;
            align-items: center
        }

        .login-carta:hover{
            background-color: linen;
        }

        section#contact{
            background-size: cover;
        }

        .deshabilitar div {
            opacity: 0;
            transition: .5s ease;
        }

        .deshabilitar:hover div {
          opacity: 1;
        }

        .cartaImagen{
            opacity: 1;
            transition: .5s ease;
            backface-visibility: hidden;
        }

        .deshabilitar:hover .cartaImagen {
          opacity: 0.2;
        }

        .colorContrario{
            /* mix-blend-mode: difference; */
            background: inherit;
            filter: invert(1);
        } 

        .haAclf{
            width: 100% !important;
        }

        #portfolio .portfolio-item .portfolio-link .portfolio-hover{
            background: none;
            position: absolute;
            width: 100%;
            top: 0;
            height: 100%;
            transition: all ease .5s;
            opacity: 0;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            transition: 0.3s;
        }

        #portfolio .portfolio-item .portfolio-link .portfolio-hover .portfolio-hover-content{
            background: rgb(155 106 40 / 100%);
            font-size: 26px;
            position: absolute;
            top: 87%;
            width: 100%;
            height: max-content;
            /* height: 20px; */
            /* margin-top: -12px; */
            text-align: center;
            color: #fff;
            
        }

        @media screen and (max-width:425px){
            .claseImagen{
                min-width: 326px;
                max-width: 326px;
                min-height: 171px;
                max-height: 171px;
                object-fit: contain;
            }
        }
        
        @media screen and (min-width:425px){
            .claseImagen{
                max-width: -webkit-fill-available;
                object-fit: contain;
                min-width: 171px;
            }
        }
        
        .tituloEvento{
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .descripcionEvento{
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #regForm div.tab{
            *display: none;
            opacity: 1;
            transition: 200ms ease-in-out;
        }

        #regForm div.tab:hover{
            *display: inline-block;
            opacity: 0;
            transition: 200ms ease-in-out;
        }

        #regForm div.tab.remove{
            display: block;
            transition: 200ms ease-in-out;

        }

        .quitarBordes{
            border: none;
            text-align-last: center;
        }

        #btnGoogle{
            width:100%;
            color:#fff;
        }

        .shadowImg{
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            transition: all 0.3s cubic-bezier(.25,.8,.25,1);
        }
        .shadowImg:hover{
            box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
        }

        .borde-texto {
          color: white;
          text-shadow: 0px 0px 0px #000, 0px 0px 0px #000, 0px 0px 0 #000, 0px 1px 2px #000;;
        }

        /* .g_id_signin{
            width: 100%;
            height: 100%;
            padding: auto;
        } */

        /* .transicion:hover{
            transition: 200ms ease-in-out;
            opacity: 0;
        } */
    </style>



    
        
<!-- Modal -->
<div class="modal modalCargando" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-body" style="align-self: center;">
        <div class="lds-spinner">
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Modal omitir pago-->
<div class="modal" id="modalConfirmarOmitirCompra" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Confirmar omitir pago: </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body" style="align-self: center;">
        <p>¿Estás seguro que quieres omitir el pago de la compra?</p>
      </div>

      <div class="modal-footer justify-content-around">
        <button type="button" id="cerrarModalConfirmar" class="btn btn-outline-secondary btn-cerrar-modal-sesiones" onclick="CerrarModal();" data-bs-dismiss="modal">
          Cerrar
        </button>
        <button type="button" onclick="crearClienteUsuario()" class="btn btn-outline-primery btn-cerrar-modal-sesiones">
          Confirmar
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Modal Mensaje generación exitosa-->
<div class="modal" id="modalAgendaGenerada" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Agendado exitosamente</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body" style="align-self: center;">
        <p id="mensajeAgendaExitosa"></p>
      </div>

      <div class="modal-footer justify-content-around">
        <button type="button" id="cerrarModalConfirmar" class="btn btn-outline-secondary btn-cerrar-modal-sesiones" onclick="CerrarModal();" data-bs-dismiss="modal">
          Aceptar
        </button>
      </div>

    </div>
  </div>
</div>

<!-- SECCION SELECCION BOLETOS -->

<div class="container" style="padding-top: 120px">
  <section style="padding-top: 20px; padding-bottom: 20px">
    <!-- <button type="button" class="btn btn-info" onclick="MostrarModal()">info</button> -->
    <!-- <h1 class="px-3">Evento</h1> -->

    <!-- <div class="container" id="container"> -->
      <!-- <div class="row"> -->

        <!-- <div class="col-sm-12 col-md-6 col-lg-4 offset-lg-0 my-2" id="panelImagenEvento"> -->        
          <!-- <div class="card deshabilitar shadowImg"> -->
              <!-- <img class="card-img w-100 d-block cartaImagen shadow-sm rounded" src="https://boletos.vinosparvada.com/uploads/1659136180_f2238e6fb30ef49355e9.jpg"> -->
              
              <!-- <div class="card-img-overlay text-center colorContrario"> -->
              <!-- <h4 class="text-center tituloEvento">
              CATA DE VINO 
              </h4> -->
              <!-- <p class="lead descripcionEvento">
              2024-07-04
              </p> -->
          <!-- </div> -->
        <!-- </div> -->
      <!-- </div> -->

        <div class="col-sm-12 col-md-6 col-lg-8 my-2 " id="panelDetallesEvento">

          <!-- Modal para agrandar imágen de términos y condiciones -->
          <!-- <div id="imagenInfoRecorridos">
            <div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
               <span class="close">&times;</span> -->
              <!-- <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <img class="modal-content-precios" id="img01">
                  <div id="caption"></div>
                </div>
              </div>
            </div>
          </div> --> 

          <!-- PASO 2 -->
          <!-- <div id="panel2" class="container shadow" style="background-color: #eee!important; display:none;">
            <a class="btn btn-sm" href="#" style="letter-spacing: initial;" onclick="retroceder(2)">
              &lt; Regresar </a>
                <h3 class="p-2">Boletos</h3>
                <div class="">

                  <div class="row align-items-center">
                    <h4 id="clasificacionTexto" class="col-sm-12 col-md-12 text-center"></h4>

                    <h4 id="msgEntrada" class="fw-light" style="text-align: center;"></h4>
                    <div id="incluirParvaditos" style="display: none;">
                      <input type="checkbox" class="form-check-input" name="parvaditos" id="checkParvaditos" onchange="mostrarParvaditos()" value="checkedValue">
                      <label for="parvaditos" class="form-check-label" style="align-self: flex-end;">Incluir Parvaditos <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#informacionParvaditosModal">¿Qué incluye?</button></label>
                    </div> -->

                    <!-- <h5 id="clasificacionPrecio" class="fw-light col-sm-12 col-md-4 text-center my-2"></h5> -->

                    <!-- <div id="cantidadBoletosAdultos">
                      <div class="inputField col-sm-12 col-md-8 my-2">
                        <h5 id="clasificacionPrecio" class="fw-light" style="text-align: center;"></h5>
                        <input id="cantidadBoletos" class=" fw-light col-sm-12 col-md-8 my-2 form-control boletos" type="number" style="text-align: end!important;" min="0" placeholder="" inputmode="numeric">

                      </div>
                    </div>
                    <div id="cantidadParvaditos" style="display: none;">
                      <div class="inputField col-sm-12 col-md-8 my-2">
                        <h4 class="fw-light" style="text-align: center;">
                          Entradas Parvaditos (5-11 años):
                        </h4>
                        <h5 id="clasificacionPrecioParvaditos" class="fw-light" style="text-align: center;">  </h5>
                        <input id="cantidadBoletosParvaditos" class=" fw-light col-sm-12 col-md-8 my-2 form-control boletos" type="number" style="text-align: end!important;" min="0" placeholder="Cantidad entradas Parvaditos" inputmode="numeric">
                      </div>
                    </div>
                    <div id="seccionBoletosMenores" style="display: none;">

                    </div>
                    <div id="mensajeAlerta" class="alert alert-danger" style="display: none;" role="alert">
                          Selecciona una cantidad que esté dentro del rango de boletos disponibles.
                        </div>


                    <h5 id="maximoBoletos" style="visibility:hidden;" class="fw-light col-sm-12 col-md-6 my-3">
                    </h5>
                    <div class="d-flex justify-content-around col-sm-12 col-md-6 align-middle">
                      <span> Total:</span>
                      <span id="precioTotal"> $0.00 </span>
                    </div>

                  </div>

                </div> -->

                <!-- PANEL BOTONES -->
                <!-- <div class="d-flex justify-content-around">
                  <button type="button" class="btn btn-light btn-secondary my-2" onclick="retroceder(2)">Regresar</button>
                  <button id="btnBoletos" type="button" class="btn my-2" style="background-color: #0d6efd; color: white;" onclick="continuar(2)" disabled="disabled">Continuar</button>
                </div>

                <div class="modal fade" id="informacionParvaditosModal" tabindex="-1">
                  <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title">El acceso a Parvaditos incluye:</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <img class="img-responsive" style="margin:0 auto; width:100%" src="../assets/img/FOTOS_VINOS/Parvaditos Texto 2.jpg">
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                      </div>
                    </div>
                  </div>
                </div>

          </div> -->
          <!-- FIN PASO 2 -->

              

          <!-- PASO 3  -->
          <!-- <div id="panel3" class="container shadow" style="background-color: #eee!important;display:none;">
            <a class="btn" href="#" style="letter-spacing: initial;" onclick="retroceder(3)">
              &lt; Regresar</a>
                <h3 class="p-2">Confirmación</h3>

                <div id="bodyConfirmacion">

                </div> -->


                <!-- PANEL BOTONES -->
                <!-- <div class="d-flex justify-content-around">
                  <button type="button" class="btn btn-light btn-secondary my-2" onclick="retroceder(3)">Regresar</button>
                  <button type="button" class="btn my-2" id="btnConfirmacion" style="background-color: #0d6efd; color: white;" onclick="continuar(3)">Continuar</button>
                </div>
          </div> -->
          <!-- FIN PASO 3 -->

          <!-- PASO 4 DATOS PARA PAGO -->
          
          <!-- FIN PASO 4 -->
        
        <!-- <div id="panel4" class="container shadow shadow-1 pb-3" style="background-color: #eee!important; display:block;">
          <h3 class="p-2">Clasificaciones</h3>
          
              <div id="2" class="btn btn-light  border border-4 d-block mx-3 py-3" onclick="getBoletosClasificacion(2,900.00,'ADULTOS',16, 1)">
                  <div class="d-flex justify-content-between">
                    <span class="mx-1" style="align-self: center; text-align:start;">
                      ACCESO ADULTOS
                    </span>
                    <div class="row">
                      <span class="mx-1 col-12" style="align-self: center;">
                        MX$900.00
                      </span>
                      <span class="mx-1 col-12 fw-light" style="align-self: center;">
                        Boletos Disponibles: 16
                      </span>

                        </div>

                      </div>
                    </div>
              
              <div id="24" class="btn btn-light  border border-4 d-block mx-3 py-3" onclick="getBoletosClasificacion(24,1250.00,'PREMIUM',16, 1)">
                  <div class="d-flex justify-content-between">
                    <span class="mx-1" style="align-self: center; text-align:start;">
                      ACCESO PREMIUM
                    </span>
                    <div class="row">
                      <span class="mx-1 col-12" style="align-self: center;">
                        MX$1250.00
                      </span>
                      <span class="mx-1 col-12 fw-light" style="align-self: center;">
                        Boletos Disponibles: 16
                      </span>

                        </div>

                      </div>
                    </div>
              
        </div> -->


        <div id="panel1" class="container shadow" style="background-color: #eee!important; display:block;">
            <!-- <a class="btn" href="#" style="letter-spacing: initial;" onclick="retroceder(4)"> -->
              <!-- &lt; Regresar</a> -->
                <h3 class="p-2 ">Datos de pago</h3>
              
                <div class="row">
                  <form id="pago-form">

                    <fieldset>
                      <div id="mensajeCompraExitosa"></div>
                      <div class="alert alert-danger" role="alert">
                        ¡No compartas tu código de compra!
                      </div>
                      <div id="mensajeCorreo"></div>
                      <!-- <div id="conektaIframeContainer" class="container" style="height:650px"></div> -->
                      <!-- <div id="openPayFrameContainer" class="container" style="height:650px; width:740px; overflow-y:scroll; "></div> -->
                      <div class="creditCardForm" id="ccForm">
          <div class="heading">
              <h1>Confirmar compra</h1>
              <div class="alert alert-info" role="alert">
                De momento sólo aceptamos tarjetas Visa/Mastercard.
              </div>      
          </div>
          <div class="payment">
              <form id="payment-form">
                  <input type="hidden" name="token_id" id="token_id">
                  <input type="hidden" name="deviceIdHiddenFieldName" id="deviceIdHiddenFieldName">
                  <div class="form-group" style="text-align: center; ">
                  <!-- <div style="text-align: center;"> -->
                    <img src="https://public.openpay.mx/images/logos/openpay/logo_login.png">
                  <!-- </div> -->
                  </div>
                  <div class="form-group owner">
                      <label for="owner">Nombre del titular</label>
                      <input type="text" class="form-control" id="owner" placeholder="Como aparece en la tarjeta" autocomplete="off" data-openpay-card="holder_name">
                  </div>                
                  <div class="form-group" id="card-number-field">
                      <label for="cardNumber">Número de tarjeta</label>
                      <input type="text" class="form-control" id="cardNumber" maxlength="16" autocomplete="off" data-openpay-card="card_number">
                  </div>
                  <div class="form-group" id="expiration-date">
                      <label>Fecha de expiración</label>
                      <select data-openpay-card="expiration_month">
                          <option value="01">Enero</option>
                          <option value="02">Febrero </option>
                          <option value="03">Marzo</option>
                          <option value="04">Abril</option>
                          <option value="05">Mayo</option>
                          <option value="06">Junio</option>
                          <option value="07">Julio</option>
                          <option value="08">Agosto</option>
                          <option value="09">Septiembre</option>
                          <option value="10">Octubre</option>
                          <option value="11">Noviembre</option>
                          <option value="12">Diciembre</option>
                      </select>
                      <select data-openpay-card="expiration_year">                          
                          <option value="23">2023</option>
                          <option value="24">2024</option>
                          <option value="25">2025</option>
                          <option value="26">2026</option>
                          <option value="27">2027</option>
                          <option value="28">2028</option>
                          <option value="29">2029</option>
                          <option value="30">2030</option>
                          <option value="31">2031</option>
                          <option value="32">2032</option>
                          <option value="33">2033</option>
                      </select>                    
                  </div>
                  <div class="form-group cvv">
                      <label for="cvv">CVV</label>
                      <input type="text" class="form-control" id="cvv" autocomplete="off" data-openpay-card="cvv2">
                  </div>
                  <div hidden="" class="form-group parcializacion">
                    <label for="Parcialidades">Parcialidades</label>
                    <select id="parcialidades">
                      <option value="1">Un sólo pago</option>
                      <!-- <option value="3">3 meses sin intereses</option> -->
                      <!-- <option value="6">6 meses sin intereses</option> -->
                      <!-- <option value="9">9 meses sin intereses</option> -->
                      <!-- <option value="12">12 meses sin intereses</option> -->
                      <!-- <option value="18">18 meses sin intereses</option> -->
                    </select>
                  </div>
                  <div class="form-group" id="credit_cards">
                      <!-- <img src="https://public.openpay.mx/images/logos/openpay/logo_login.png"> -->
                      <img src="https://boletos.vinosparvada.com/assets/img/visa.jpg" id="visa">
                      <img src="https://boletos.vinosparvada.com/assets/img/mastercard.jpeg" id="mastercard">
                      <!-- <img src="https://boletos.vinosparvada.com/assets/img/amex.jpg" id="amex"> -->
                  </div>
                  <div class="form-group" id="debit_cards">
                      <img src="https://boletos.vinosparvada.com/assets/img/afirme.png" width="10%" height="10%" id="afirme">
                      <img src="https://boletos.vinosparvada.com/assets/img/bancoAzteca.png" width="10%" height="10%" id="bancoAzteca">
                      <img src="https://boletos.vinosparvada.com/assets/img/banorte.png" width="10%" height="10%" id="banorte">
                      <img src="https://boletos.vinosparvada.com/assets/img/banregio.png" width="10%" height="10%" id="banregio">
                      <img src="https://boletos.vinosparvada.com/assets/img/BBVA.png" width="10%" height="10%" id="BBVA">
                      <img src="https://boletos.vinosparvada.com/assets/img/citibanamex.png" width="10%" height="10%" id="citibanamex">
                      <img src="https://boletos.vinosparvada.com/assets/img/hsbc.png" width="10%" height="10%" id="hsbc">
                      <img src="https://boletos.vinosparvada.com/assets/img/inbursa.png" width="10%" height="10%" id="inbursa">
                      <img src="https://boletos.vinosparvada.com/assets/img/invex.png" width="10%" height="10%" id="invex">
                      <img src="https://boletos.vinosparvada.com/assets/img/ixe.png" width="10%" height="10%" id="ixe">
                      <img src="https://boletos.vinosparvada.com/assets/img/santander.png" width="10%" height="10%" id="santander">
                      <img src="https://boletos.vinosparvada.com/assets/img/scotiabank.png" width="10%" height="10%" id="scotiabank">
                    </div>
                  <div class="form-group" id="pay-now">
                      <btn class="btn btn-default" id="pay-button" onclick="botonPagar(this)">Procesar pago</btn>
                  </div>
              </form>
          </div>
      </div>
                    </fieldset>

                  </form>
                </div>
                <!-- PANEL BOTONES -->
                <hr>
                <div class="d-flex justify-content-around" id="panel4Botones">
                  <button type="button" class="btn btn-light btn-secondary my-2" onclick="retroceder(4)">Regresar</button>
                  <!-- <button type="button" class="btn my-2" style="background-color: #0d6efd; color: white;" onclick="continuar(4)">Continuar</button> -->
                  <div id="btn-pago-usuario"></div>
                </div>
          </div>

            <hr>
            <!-- <div class="mt-3" id="panelImgRecorrido">
                <img loading="lazy" id="imagenRecorrido" class="card-img mx-auto shadowImg" style="display:block; width:75%; padding:5px; border: 1px solid #ddd;border-radius: 4px;" src="https://boletos.vinosparvada.com//uploads/1690917279_312ef291c818bb6d1972.jpg" onerror="quitarSeccionImagenRecorrido()">
            </div> -->
          </div>
      </div>
    </div>

    <!-- <div id="canvas" style="display: none!important;"></div> -->

  </section>

  
</div>

<script>
  let precioSeleccionado = 0,
    clasificacion_id = 0,
    clasificacion = "",
    clasificacionMenores = 0,
    cantidadBoletos = 0,
    contenido = 1,
    cantidadBoletosMenores = 0,
    boletosDisponibles = 0,
    total = 0,
    precioMenores = 0;
  let nombre = "",
    correo = "",
    numTarjeta = "",
    fechaTarjeta = "",
    cvv_ = "";
  var precioProgA;
  var precioProgM;
  var topeBProg;
  var procesadorPredet = null;
  var requiereFactura = false;

  var horarioElegido = 0;

  var cliente_id = 0;
  var nombre_usuario = "";
  var correo_usuario = "";
  var correo_confirmar = "";
  var telefono_usuario = "";
  var politica_check = "";
  var deviceSessionId = "";

  //Se utilizaba para facturas pero se cambió a CompraRealizada.php (Views)
  var paisSel = 0;
  var estadoSel = 0;
  var ciudadSel = 0;
  var claveFiscal = 0;
  var claveUsoCFDI = 0;
  var datosFModificados = false;

  var pagarPresionado = false;
  var redirecPendiente = false;
  var url3dsec = "";
  var eventoHorarioIdSesion = 0;

  let paisCargado = false;
  let estadoCargado = false;
  let ciudadCargada = false;
  let regimenCargado = false;
  let usoCargado = false;

  let parvaditos = false;
  let precioParvaditos = 0;
  let disponiblesParvaditos = 0;
  let clasificacionParvaditos = 0;
  let cantidadBoletosParvaditos = 0;

  //VARIABLE CONTENIDO SIRVE COMO MULTIPLICADOR EN LOS EVENTOS (INDICA LA CANTIDAD DE BOLETOS POR MESA)

  // VARIABLES PARA PROCESAR PAGO POR CONEKTA
  let itemsOrdenCompra = {};

  // VARIABLES DEL PHP PARA JAVASCRIPT
  //let id_evento =  ?? 0 ;
  console.log( 1 );

  let eventoNombre = "",
    eventoFecha = "",
    eventoHora = "";

  let panelDetallesEvento = $("#panelDetallesEvento"),
    panelImagenEvento = $("#panelImagenEvento"),
    container = $("#container");
  
  $(document).ready(function () 
  {
    // $("#panel2").fadeOut( 1000 );
    $("#panel2").hide();
    $("#panel3").hide();
    $("#panel4").hide();
    $("#seccionBoletosMenores").hide();
    // ------------------------VARIABLES PARA INFORMACIÓN DEL USUARIO-----------
    // nombre_usuario = $("#nombre");
    // correo_usuario = $("#correo");
    // correo_confirmar = $("#correo2");
    // telefono_usuario = $("#numeroTel");
    // politica_check = $("#TYC");

    //------------------------MÉTODOS PARA OPEN PAY----------------------------
    //LINEAS DE PRUEBAS
    //OpenPay.setId('mf6pbhlxhkyuhcgih3h4');
    //OpenPay.setApiKey('pk_fb808ef65927499a810b3a73ab0bef28');
    //OpenPay.setSandboxMode(true);

    //PRODUCCION
    OpenPay.setId('m730u8lzas5f1xo7kuyw');
    OpenPay.setApiKey('pk_fa9711857ee843f8b88efae84657ce1f');
    OpenPay.setSandboxMode(false);

    deviceSessionId = OpenPay.deviceData.setup("payment-form", "deviceIdHiddenFieldName");
    // ----------------------- INPUT CANTIDAD DE BOLETOS -----------------------
    $("#btnBoletos").attr("disabled", true);

    $("#mes").on('input', function () {
      let valorMes = $("#mes").val();
      if ( valorMes.length > 1) 
        $("#año").focus();
    });

    $("#año").on('input', function () {
      let valoraño = $("#año").val();
      if ( valoraño.length > 1) 
        $("#cvv").focus();
    });

    $("#cantidadBoletos").on('input',inputBoletos);
    $("#cantidadBoletosParvaditos").on('input', inputBoletos);
    $("#cantidadParvaditos").hide();
    //$("#paisF").on('change', cargarEstados);

    $('#incluirParvaditos').hide();
    //$('#cantidadBoletosParvaditos').hide();

    //VERIFICAR CARGO PENDIENTE 3D SECURE
    cargosPendientes3dSecure();
    
  });

  function cargosPendientes3dSecure()
  {
    let params = new URLSearchParams(location.search);
    var transaccion = params.get('id');
    console.log("Cargos pendientes Transaction ID "+transaccion);

    if(transaccion != null && transaccion != '')
    {
      $('#panel1').hide();
      $.ajax(
      {
        url: "https://boletos.vinosparvada.com/Eventos/verificarEstatusTransaccion",
        type:"POST",
        data: {'transaccion_id':transaccion},
        success: function( res )
        {
          console.log(JSON.stringify(res));
          console.log("ESTATUS "+res.STATUS);
          let resStatus = res.STATUS;
          if(res.EXISTE)
          {
            //YA ESTÁ CREADA LA COMPRA
          }
          else if(res.STATUS == 'completed')
          {
            MostrarModal();
            $('#panel1').hide();
            $('#panel2').hide();
            $('#panel3').hide();
            $('#conektaIframeContainer').hide();
            $('#openPayFrameContainer').hide();
            //$('#panel4').show();
            // $("#mensajeCompraExitosa").append(`
            // <div class="alert alert-success my-1" style="text-align: center;" role="alert">
            //   <strong>¡La compra fue exitosa! A continuacion, presiona el boton 'Ver Codigo' para guardar tus boletos.</strong>
            // </div>`);

            generarBoletosOpenPay(res.ID);
          }
          else if(resStatus == "failed")
          {
            console.log("Falló la compra");
            MostrarModal()
            
            $('#panel1').hide();

            panelDetallesEvento.append(` 
            <h2 class=" section-heading">
              No pudimos procesar tu compra
            </h2>
            <h3>
              Lo sentimos, ocurrió un error con tu pago, por favor reinténtalo.
            </h3>`);
            // $('#panel2').hide();
            // $('#panel3').hide();
            // $('#conektaIframeContainer').hide();
            // $('#openPayFrameContainer').hide();
            // $("#panelAlertas").empty();
            // $('#panel4').show();
            // $("#panelAlertas").append(`<div class="alert alert-warning my-1" style="text-align: center;" role="alert">
            //                       Ocurrió un error. ${res.MSG}
            //                     </div>`);
            CerrarModal();
            setTimeout(function() {
              window.location = "https://boletos.vinosparvada.com/";
            }, 5000);
          }
        }
      })
    }
  }

  function botonPagar(btnPagar)
  {
    console.log("PAGAR PRESIONADO");
    
    
    let numTarjeta = $("#cardNumber");
    let cvvTarjeta = $("#cvv");
    let owner = $("#owner");
    var isCardValid = $.payform.validateCardNumber(numTarjeta.val());
    var isCvvValid = $.payform.validateCardCVC(cvvTarjeta.val());

    if(owner.val().length < 5){
      $("#pay-button").prop( "disabled", false);
      document.getElementById('pay-button').textContent = 'Procesar pago';
      pagarPresionado = false;
      alert("Nombre de tarjetahabiente incorrecto.");
    } else if (!isCardValid) {
      $("#pay-button").prop( "disabled", false);
      document.getElementById('pay-button').textContent = 'Procesar pago';
      pagarPresionado = false;
      alert("Número de tarjeta no válido.");
    } else if (!isCvvValid) {
      $("#pay-button").prop( "disabled", false);
      document.getElementById('pay-button').textContent = 'Procesar pago';
      pagarPresionado = false;
      alert("CVV no válido.");
    } else {
      if(pagarPresionado == false)
      {
        pagarPresionado = true;
        var tarjetaIngresada = document.getElementById('cardNumber').value;
        tarjetaIngresada = tarjetaIngresada.trim();
        var primerDigito = tarjetaIngresada.charAt(0);
        console.log("Primer dígito AMEX " + tarjetaIngresada);
        console.log(primerDigito);
        if(primerDigito == '3')
        {
          alert("Por el momento no se aceptan pagos con American Express, gracias por tu comprensión.");
          pagarPresionado = false;
        }
        else
        {
          OpenPay.token.extractFormAndCreate('payment-form', success_callbak, error_callbak);
        }
      }
      else if(pagarPresionado == true)
      {
        alert("Ya hay un pago en proceso, por favor espere respuesta de su banco.");
      }
    }    
  }

  var success_callbak = function(response) 
  {
    //console.log("SUCCESS CALLBACK");
    //ActualizarCliente
    if(sesionIniciadaFB || sesionIniciadaGoogle)
    {
      if(sesionIniciadaFB) //INICIO CON FACEBOOK
      {
        var datosActualizar = {
          CORREO: $("#correo").val(),
          TELEFONO: $("#numeroTel").val(),
          FB_ID: 'TRUE',
          GOOGLE_ID: ''
        }
      }
      else if(sesionIniciadaGoogle) //INICIO CON GOOGLE
      {
        //console.log("Has own property SUB (google) " + google_id);
        var datosActualizar = {
          CORREO: $("#correo").val(),
          TELEFONO: $("#numeroTel").val(),
          FB_ID: '',
          GOOGLE_ID: 'TRUE'
        }
      }

      $.ajax(
      {
        url: "https://boletos.vinosparvada.com/Clientes/ActualizarClienteCompra",
        type:"POST",
        data: datosActualizar,
        // beforeSend: function()
        // {
        //   MostrarModal();
        // },
        success: function( res )
        {
          let estatus = res.ESTATUS || "ERROR";

          if (estatus == "CORREO") 
          {
            $("#mensajeCorreo").empty();
            $("#mensajeCorreo").append(`<div class="alert alert-warning my-1" style="text-align: center;" role="alert">
                                ${res.MSG}
                              </div>`);
          }

          if (estatus == "ERROR") 
          {
            $("#panelAlertas").empty();
            $("#panelAlertas").append(`<div class="alert alert-warning my-1" style="text-align: center;" role="alert">
                                Ocurrió un error: ${res.MSG}
                              </div>`);
            CerrarModal();
          }
          else{
            //console.log("Actualizado correctamente");
            $("#panelAlertas").empty();
            $("#panel3").fadeOut(100);
           // $("#panel4").delay(100).fadeIn(100);
          }          
        },
        error:function( res )
        {
          console.log(res);
          $("#panelAlertas").empty();
          $("#panelAlertas").append(`<div class="alert alert-warning my-1" style="text-align: center;" role="alert">
                                Ocurrió un error. ${res.MSG}
                              </div>`);
          CerrarModal();
        }
      });
      
    }

    let descripcionCargo = eventoNombre+' '+eventoFecha+' '+eventoHora + " Adul-Prem:"+cantidadBoletos+" M:"+cantidadBoletosMenores+" P:"+cantidadBoletosParvaditos;

    let panelAlertas = $("#panelAlertas");
    panelAlertas.empty();
    nombre_usuario.removeClass("error");
    correo_usuario.removeClass("error");
    correo_confirmar.removeClass("error");
    telefono_usuario.removeClass("error");

    let cargoTotal = 0;

    if(totalAdultos > 0 && totalMenores == 0)
    {
      cargoTotal = (precioSeleccionado * (cantidadBoletos * contenido));
    }

    else if(totalAdultos > 0 && totalMenores > 0)
    {
      cargoTotal = (precioSeleccionado * (cantidadBoletos * contenido)) + (precioMenores * cantidadBoletosMenores);    
    }
    else if(totalAdultos > 0 && totalMenores > 0 && totalParvaditos)
    {
      cargoTotal = (precioSeleccionado * (cantidadBoletos * contenido)) + (precioMenores * cantidadBoletosMenores) + (precioParvaditos * cantidadBoletosParvaditos);
    }

    var token_id = response.data.id;
    $('#token_id').val(token_id);

    let datosCompra = new FormData();
    datosCompra.append("NOMBRE", $('#nombre').val() );
    datosCompra.append("TELEFONO", $('#numeroTel').val() );
    datosCompra.append("CORREO", $('#correo').val() );
    datosCompra.append("MONTO_CARGO", cargoTotal)
    datosCompra.append("PARCIALIDADES", $('#parcialidades').val());
    datosCompra.append("TOKEN", token_id);
    datosCompra.append("DESCRIPCION", descripcionCargo);
    datosCompra.append("DEVICE_SESSION_ID", deviceSessionId);

    let ruta = "https://boletos.vinosparvada.com/Eventos/CargoOpenpay";

    $.ajax({
      url: ruta,
      type:"POST",
      data: datosCompra,
      processData: false,
      contentType: false,
      beforeSend: function()
      {
        MostrarModal();
      },
      success: function(datos)
      {
        console.log(datos);
        console.log(datos.PAYMENT_METHOD);

        if(datos.STATUS == "charge_pending")
        {
          url3dsec = datos.PAYMENT_METHOD.url;
          console.log("Liga de redireccionamiento: " + url3dsec);
          redirectPendiente = true;

          if(redirectPendiente === true)
          {
            console.log("Guardar los datos en sesión 3d");
            let urlDatosCompra3d = "https://boletos.vinosparvada.com/Eventos/datosCompra3d";
            let datosCompra3d = new FormData();

            datosCompra3d.append("COMPRA_3D_SECURE", "true");
            datosCompra3d.append("CEVENTO_ID", 1);
            datosCompra3d.append("CCANTIDAD_BOLETOS", (cantidadBoletos * contenido));
            datosCompra3d.append("CCANTIDAD_BOLETOS_MENORES", cantidadBoletosMenores);
            datosCompra3d.append("CCANTIDAD_BOLETOS_PARVADITOS", cantidadBoletosParvaditos);
            datosCompra3d.append("CPRECIO_BOLETOS_MENORES", precioMenores);
            datosCompra3d.append("CPRECIO_BOLETOS_PARVADITOS", precioParvaditos);
            datosCompra3d.append("CCLASIFICACION", clasificacion_id);
            datosCompra3d.append("CCLASIFICACION_MENORES", clasificacionMenores);
            datosCompra3d.append("CCLASIFICACION_PARVADITOS", clasificacionParvaditos);
            datosCompra3d.append("CPRECIO_BOLETOS", precioSeleccionado);
            datosCompra3d.append("CEVENTO_HORARIO_ID", horarioElegido );
            datosCompra3d.append("CCLIENTE_ID", cliente_id);
            if ( $("#chkCortesia").length > 0 && $("#chkCortesia").is(":checked") ) {
              datosCompra3d.append( "CCORTESIA", "S" );
            } else {
              datosCompra3d.append( "CCORTESIA", "N" );
            }
            datosCompra3d.append("CNOMBRE_RECEPTOR", $("#nombre").val());

            if(requiereFactura == true)
            {
              console.log("SI REQUIERE FACTURA GUARDADO DE DATOS EN 3D");
              let cdescripcionRegimen = $('select[id="regimenF"] option:selected').text();

              datosCompra3d.append("CREQUIERE_FACTURA", 'S');
              if(datosFModificados == true)
              {
                console.log("DATOS DE FACTURA MODIFICADOS TRUE");
                datosCompra3d.append("CDATOS_FACTURA_MODIFICADOS", 'S');
              }
              else
              {
                datosCompra3d.append("CDATOS_FACTURA_MODIFICADOS", 'N');
              }
              datosCompra3d.append("CRFC", $("#RFC").val());
              datosCompra3d.append("CNOMBRE_FAC",$("#nombreF").val());
              datosCompra3d.append("CCALLE_FAC",$("#calleF").val());
              datosCompra3d.append("CNUMERO_FAC",$("#numeroF").val());
              datosCompra3d.append("CCP_FAC",$("#cpF").val());
              datosCompra3d.append("CCOLONIA_FAC",$("#coloniaF").val());
              datosCompra3d.append("CPAIS_FAC",$("#paisF").val());
              datosCompra3d.append("CESTADO_FAC",$("#estadoF").val());
              datosCompra3d.append("CCIUDAD_FAC",$("#ciudadF").val());
              datosCompra3d.append("CPERSONA_FAC",$("#personaF").val());
              datosCompra3d.append("CREGIMEN_DES_FAC", cdescripcionRegimen);
              datosCompra3d.append("CREGIMEN_FAC",$("#regimenF").val());
              datosCompra3d.append("CUSO_CFDI",$("#usosCFDI").val());

            }
            else if(requiereFactura == false)
            {
              datosCompra3d.append("CREQUIERE_FACTURA", 'N');
              datosCompra3d.append("CDATOS_FACTURA_MODIFICADOS", 'N');
              datosCompra3d.append("CRFC",'');
              datosCompra3d.append("CNOMBRE_FAC",'');
              datosCompra3d.append("CCALLE_FAC",'');
              datosCompra3d.append("CNUMERO_FAC",'');
              datosCompra3d.append("CCP_FAC",'');
              datosCompra3d.append("CCOLONIA_FAC",'');
              datosCompra3d.append("CPAIS_FAC",'');
              datosCompra3d.append("CESTADO_FAC",'');
              datosCompra3d.append("CCIUDAD_FAC",'');
              datosCompra3d.append("CPERSONA_FAC",'');
              datosCompra3d.append("CREGIMEN_DES_FAC", '');
              datosCompra3d.append("CREGIMEN_FAC",'');
              datosCompra3d.append("CUSO_CFDI",'');
            }

            for (const value of datosCompra3d.values()) {
              console.log(value);
            }

            $.ajax({
              url: urlDatosCompra3d,
              type: "POST",
              data: datosCompra3d,
              processData: false,
              contentType: false,
              success: function(resSave)
              {
                if(resSave.ESTATUS == 'OK')
                {
                  console.log("DATOS SALVADOS RESPUESTA OK");
                  console.log(resSave.ESTATUS);
                  setTimeout(function(){
                    window.location.href = url3dsec;
                }, 1000);
                  
                }
                else if(resSave.ESTATUS == 'ERROR')
                {

                }
              }
            })
          }
        }

        else if(datos.ESTATUS == "ERROR")
        {
          $("#pay-button").text('Procesar pago');
          pagarPresionado = false;
          alert("No se pudo completar la compra con tu tarjeta.");
        }
        else if(datos.id != '' && datos.AUTHORIZATION)
        {
          //console.log("Lanzar método para generar los boletos");
          generarBoletosOpenPay(datos.ID);
        }
        CerrarModal();
      },
      error:function( res )
      {
        console.log(res);
        $("#panelAlertas").empty();
        $("#panelAlertas").append(`<div class="alert alert-warning my-1" style="text-align: center;" role="alert">
                              Ocurrió un error. ${res.MSG}
                            </div>`);
        CerrarModal();
      }
    });

  };

  var error_callbak = function(response) 
  {
    var desc = response.data.description != undefined ?
        response.data.description : response.message;
    alert("ERROR [" + response.status + "] " + desc);
    $("#pay-button").prop("disabled", false);
    $("#pay-button").text('Procesar pago');
    pagarPresionado = false;
  };

  function generarBoletosOpenPay(folio_autorizacion) {
    let ruta = "https://boletos.vinosparvada.com/Eventos/pagoCompra2";
    eventoHorarioIdSesion = 0;
    let compra3dsecure = '';

    let datosForm = new FormData();

    if (compra3dsecure === true) {
      console.log("Comparacion === true");
    }

    if (compra3dsecure == 'true') {
      //console.log("entré en if de boletos 3dsecure");
      datosForm.append("EVENTO_ID", );
      datosForm.append("CLIENTE_ID", );
      datosForm.append("CANTIDAD_BOLETOS", );
      datosForm.append("CANTIDAD_BOLETOS_MENORES", );
      datosForm.append("CANTIDAD_BOLETOS_PARVADITOS", )
      datosForm.append("PRECIO_BOLETOS", );
      datosForm.append("PRECIO_BOLETOS_MENORES", )
      datosForm.append("PRECIO_BOLETOS_PARVADITOS", )
      datosForm.append("CLASIFICACION", );
      datosForm.append("CLASIFICACION_MENORES", );
      datosForm.append("CLASIFICACION_PARVADITOS", );
      datosForm.append("PRECIO_BOLETOS", );
      datosForm.append("FOLIO_COMPRA", folio_autorizacion);
      datosForm.append("EVENTO_HORARIO_ID", );
      datosForm.append("CORTESIA", "");
      datosForm.append("NOMBRE_RECEPTOR", "");

      if ('' == 'S') {
        console.log("GENERAR BOLETOS OPEN PAY REQUIERE FACTURA");
        datosForm.append("REQUIERE_FACTURA", '');
        datosForm.append("DATOS_FACTURA_MODIFICADOS", '');
        datosForm.append("RFC", '');
        datosForm.append("NOMBRE_FAC",'');
        datosForm.append("CALLE_FAC",'');
        datosForm.append("NUMERO_FAC",);
        datosForm.append("CP_FAC",);
        datosForm.append("COLONIA_FAC",'');
        datosForm.append("PAIS_FAC",'');
        datosForm.append("ESTADO_FAC",);
        datosForm.append("CIUDAD_FAC",);
        datosForm.append("PERSONA_FAC",'');
        datosForm.append("REGIMEN_DES_FAC", '');
        datosForm.append("REGIMEN_FAC",'');
        datosForm.append("USO_CFDI",'');
      }

      for (const value of datosForm.values()) {
        console.log(value);
      }
    } else {
      datosForm.append("EVENTO_ID", 1);
      datosForm.append("CLIENTE_ID", cliente_id);
      //console.log("valor contenido " + contenido + " cantidad boletos " + cantidadBoletos);
      //console.log("EVENTO_ID: %s", 1);
      datosForm.append("CANTIDAD_BOLETOS", (cantidadBoletos * contenido));
      datosForm.append("CANTIDAD_BOLETOS_MENORES", cantidadBoletosMenores);
      datosForm.append("CANTIDAD_BOLETOS_PARVADITOS", cantidadBoletosParvaditos);
      datosForm.append("PRECIO_BOLETOS_MENORES", precioMenores);
      datosForm.append("PRECIO_BOLETOS_PARVADITOS", precioParvaditos);
      datosForm.append("CLASIFICACION", clasificacion_id);
      datosForm.append("CLASIFICACION_MENORES", clasificacionMenores);
      datosForm.append("CLASIFICACION_PARVADITOS", clasificacionParvaditos);
      datosForm.append("PRECIO_BOLETOS", precioSeleccionado);
      datosForm.append("FOLIO_COMPRA", folio_autorizacion);
      datosForm.append("EVENTO_HORARIO_ID", horarioElegido );
      if ($("#chkCortesia").length > 0 && $("#chkCortesia").is(":checked")) {
        datosForm.append("CORTESIA", "S");
      } else {
        datosForm.append("CORTESIA", "N");
      }
      // datosForm.append( "EVENTO_HORARIO_ID", 1 );
      datosForm.append("NOMBRE_RECEPTOR", $("#nombre").val());

      if (requiereFactura == true) {
        let descripcionRegimen = $('select[id="regimenF"] option:selected').text();

        datosForm.append("REQUIERE_FACTURA", 'S');
        datosForm.append("RFC", $("#RFC").val());
        datosForm.append("NOMBRE_FAC",$("#nombreF").val());
        datosForm.append("CALLE_FAC",$("#calleF").val());
        datosForm.append("NUMERO_FAC",$("#numeroF").val());
        datosForm.append("CP_FAC",$("#cpF").val());
        datosForm.append("COLONIA_FAC",$("#coloniaF").val());
        datosForm.append("PAIS_FAC",$("#paisF").val());
        datosForm.append("ESTADO_FAC",$("#estadoF").val());
        datosForm.append("CIUDAD_FAC",$("#ciudadF").val());
        datosForm.append("PERSONA_FAC",$("#personaF").val());
        datosForm.append("REGIMEN_DES_FAC", descripcionRegimen);
        datosForm.append("REGIMEN_FAC",$("#regimenF").val());        
        datosForm.append("USO_CFDI",$("#usoCFDI").val());        
        //console.log("Valor del select regimen fiscal "+descripcionRegimen);
      }
    }


    $.ajax({
      url: ruta,
      type:"POST",
      data: datosForm,
      processData: false,
      contentType: false,
      success: function(datos)
      {
        generarCodigoQR(datos.FOLIO_COMPRA, datos.DETALLE_COMPRA, false);
        $('#panel1').hide();
        $('#panel2').hide();
        $('#panel3').hide();
        $('#panel4').hide();
        $('#conektaIframeContainer').hide();
        $('#openPayFrameContainer').hide();

        $("#mensajeCompraExitosa").append(`
        <div class="alert alert-success my-1" style="text-align: center;" role="alert">
          <strong>¡La compra fue exitosa! A continuación, presiona el boton 'Ver Codigo' para guardar tus boletos.</strong>
        </div>`);

        $("#panel4Botones").append(`
          <button id="verCodigo" type="button" class="btn btn-success my-2" onclick="continuar(4)">
            Ver Código.
          </button>`
        );

        setTimeout(()=>{
          document.getElementById("verCodigo").click()
        }, 500);

        CerrarModal();
      },
      error:function( res)
      {
        console.log(res);
        $("#panelAlertas").empty();
        $("#panelAlertas").append(`<div class="alert alert-warning my-1" style="text-align: center;" role="alert">
                              Ocurrió un error. ${res.MSG}
                            </div>`);
        CerrarModal();
      }
    })
  }

  function mostrarParvaditos() {
    if (document.getElementById('checkParvaditos').checked) {

      document.getElementById("cantidadBoletosParvaditos").setAttribute('max', disponiblesParvaditos);

      $('#cantidadParvaditos').show('slow');
    } else {
      $('#cantidadParvaditos').hide('slow');
      cantidadBoletosParvaditos = 0;
    }
  }

  function inputBoletos () 
  {
    cantidadBoletos = parseInt($("#cantidadBoletos").val());
    cantidadBoletosMenores = parseInt($("#cantidadBoletosMenores").val()) || 0;
    cantidadBoletosParvaditos = parseInt($('#cantidadBoletosParvaditos').val()) || 0;
    console.log("Cant Ad: "+cantidadBoletos + " cant N: "+cantidadBoletosMenores);
    console.log("suma:",(cantidadBoletos+cantidadBoletosMenores),boletosDisponibles);

    
    if(typeof cantidadBoletosMenores === 'undefined' || isNaN(cantidadBoletosMenores))
    {
      console.log("la cant bol men no esta definida o es NaN");
      cantidadBoletosMenores = 0;
    }
    if ( isNaN(cantidadBoletos) || cantidadBoletos == 0 ) {
      $("#btnBoletos").attr("disabled", true);
      $("#precioTotal").html( ("$0.00") );
      $("#seccionBoletosMenores").hide();
    }
    //else if((cantidadBoletos + cantidadBoletosMenores) > boletosDisponibles){
    else if((cantidadBoletos) > boletosDisponibles){
      $("#btnBoletos").attr("disabled", true);
      $("#precioTotal").html( "$0.00" );
      $("#mensajeAlerta").show();
      //$("#seccionBoletosMenores").hide(false);
    }
    else
    {
      $("#mensajeAlerta").hide();
      $("#btnBoletos").attr("disabled", false);
      $("#seccionBoletosMenores").show();
      
      totalMenores = cantidadBoletosMenores * precioMenores;
      totalAdultos = (cantidadBoletos * contenido) * precioSeleccionado;
      totalParvaditos = cantidadBoletosParvaditos * precioParvaditos;
      // console.log("TOTAL MENORES: ",totalMenores, "TOTAL ADULTOS: ",totalAdultos);
      total = totalMenores + totalAdultos + totalParvaditos;

      // console.log(total);
      // $("#precioTotal").html(" Cant. " + ((cantidadBoletos * contenido) + cantidadBoletosMenores) + " - $"+total.toFixed(2) );
      $("#precioTotal").html(" Cant. " + ((cantidadBoletos * contenido) + cantidadBoletosMenores) + " - "+ new Intl.NumberFormat("en-US", { style: "currency", currency: "MXN" }).format(total) );
    }
  }
  // ----------------------- FIN INPUT CANTIDAD DE BOLETOS -----------------------

  // function retroceder( paso )
  // {
  //   switch (paso) {
  //     case 2:
  //       precioSeleccionado = 0;
  //       total = 0;

  //       $("#mensajeAlerta").hide();
  //       $("#cantidadBoletos").val( 0 );
  //       $("#precioTotal").html( "$"+ 0 );
  //       $("#maximoBoletos").html( "" );

  //       $("#panel2").fadeOut(100);
  //       $("#panel1").delay(110).fadeIn(100);
        
  //       $('#seccionBoletosMenores').empty(); //Se vacía el componente para menores cuando se cambia de tipo de recorrido la condición se cumpla correctamente
  //       $('#seccionBoletosMenores').hide();
  //       break;

  //     case 3:
  //       $("#panel3").fadeOut(100);
  //       $("#panel2").delay(110).fadeIn(100);
  //       break;
        
  //     case 4:
  //       $("#mensajeCorreo").empty();
  //       $("#panel4").fadeOut(100);
  //       $("#conektaIframeContainer").empty();
  //       $("#openPayFrameContainer").empty();
  //       $("#panel3").delay(110).fadeIn(100);
  //       break;
    
  //     default:
  //       alert("Error al retroceder...")
  //       break;
  //   }
  // }

  // ---------------------------------------------------------------------
  function continuar( paso )
  {
    MostrarModal();
    switch (paso) {
      case 2:
        $("#panel2").fadeOut(100);
        panelConfirmar();
        $("#panel3").delay(100).fadeIn(100);
        CerrarModal();
        break;

      case 3:
        let tipo_acceso = "";

        if ( tipo_acceso != "" && tipo_acceso == 'USUARIO' ) 
        {

          if ($("#omitirPago").is(':checked')) 
          {
            // modalConfirmarOmitirCompra
            let modalconfirmar = new bootstrap.Modal( document.getElementById('modalConfirmarOmitirCompra'), {} );
            modalconfirmar.show();
          }
          else
          {
            if((requiereFactura == true && camposFactura == true) || requiereFactura == false)
            {
              procesadorPredet = procesadorPredeterminado();
            }
            crearClienteUsuario()
          }
        } else if( tipo_acceso != "" && tipo_acceso == 'CLIENTE' )
        {
          let camposFactura = false;
          requiereFactura = false;
          if($("#checkFacturar").is(":checked"))
          {
            camposFactura = checarCamposFactura();
            requiereFactura = true;
          }
          
          //SI EL USUARIO HA LLENADO LOS CAMPOS CORRECTAMENTE
          if((requiereFactura == true && camposFactura == true) || requiereFactura == false)
          {
            //SI ES UN CLIENTE SE CONSULTA CUÁL TERMINAL SE UTILIZARÁ PARA PROCESAR EL PAGO
            procesadorPredet = procesadorPredeterminado();
            
            //CONTINUA EL FLUJO DE DATOS
            if(procesadorPredet == "CONEKTA")
            {
              crearDatosClienteConekta();
            }
            else if(procesadorPredet == "OPENPAY")
            {
              crearDatosOpenPay();
            }
            else if(procesadorPredet == "ERROR")
            {
              alert("No se pudo cargar el procesador de pago.");
            }
          }

          
        }else
        {
          CerrarModal();
        }
        
        
        break;

      case 4:
        window.onbeforeunload = null;
        window.location.href = 'https://boletos.vinosparvada.com/Eventos/resumenCompra'
        CerrarModal();

        break;
    
      default:
        alert("Error al continuar...")
        break;
    }
  }

  function checarCamposFactura()
  {
    let checkCamposFact = true;
    let rfc = $("#RFC");
    let nombre_fac = $("#nombreF");
    let calle_fac= $("#calleF");
    let numero_fac = $("#numeroF");
    let cp_fac = $("#cpF");
    let colonia_fac = $("#coloniaF");
    let pais_fac = $("#paisF");
    let estado_fac = $("#estadoF");
    let ciudad_fac = $("#ciudadF");
    let persona_fac = $("#personaF");
    let regimen_fac = $("#regimenF");
    let usosCFDI = $("#usosCFDI");

    if(rfc.val() == "")
    {
      rfc.addClass("error");
      checkCamposFact = false;
    }
    if(nombre_fac.val() == "")
    {
      nombre_fac.addClass("error");
      checkCamposFact = false;
    }
    if(calle_fac.val() == "")
    {
      calle_fac.addClass("error");
      checkCamposFact = false;
    }
    if(numero_fac.val() == "")
    {
      numero_fac.addClass("error");
      checkCamposFact = false;
    }
    if(cp_fac.val() == "")
    {
      cp_fac.addClass("error");
      checkCamposFact = false;
    }
    if(colonia_fac.val() == "")
    {
      colonia_fac.addClass("error");
      checkCamposFact = false;
    }
    if(pais_fac.val() == "")
    {
      pais_fac.addClass("error");
      checkCamposFact = false;
    }
    if(estado_fac.val() == "")
    {
      estado_fac.addClass("error");
      checkCamposFact = false;
    }
    if(ciudad_fac.val() == "")
    {
      ciudad_fac.addClass("error");
      checkCamposFact = false;
    }
    if(persona_fac.val() == "D")
    {
      persona_fac.addClass("error");
      checkCamposFact = false;
    }
    if(regimen_fac.val() == "")
    {
      regimen_fac.addClass("error");
      checkCamposFact = false;
    }
    if(usosCFDI.val() == "D" || usosCFDI.val() == "")
    {
      usosCFDI.addClass("error");
      checkCamposFact = false;
    }

    if(checkCamposFact == false)
    {
      CerrarModal();
      return false;
    }
    else if(checkCamposFact == true)
    {
      return true;
      console.log("CHECAR CAMPOS FACTURA DEVUELVE TRUE");
    }

  }

  // ---------------------------------------------------------------------
  function getBoletosClasificacion( id_clasificacion, precioClasificacion , clasificacionT, bolDisponibles, cont ) 
  {

    if (cont > 1) {
      $("#msgEntrada").text("Selecciona el número de mesas a comprar.");
      $("#cantidadBoletos").attr('placeholder', 'Cantidad de mesas');
    } else {
      $("#msgEntrada").text("Selecciona el número de entradas a comprar.");
      $("#cantidadBoletos").attr('placeholder', 'Cantidad de entradas');
    }
    
    //Reviso sesión iniciada
    // NULL
    let acceso = ``;

    if(acceso == `` && (!datosSesion || !datosSesion.hasOwnProperty("id")) )
    {
      //cerrarSesionFB();
      //Se abre modal, al momento de success en inicio se sesión se refresca página
      //mostrarModalSesiones();
    }
    else
    {
      //YA ESTÁ LOGGEADO EL USUARIO O EL CLIENTE
      MostrarModal(); //MOSTRAR MODAL CARGANDO
  
      let ruta = "https://boletos.vinosparvada.com/Eventos/getBoletosClasificacion";
  
      precioSeleccionado = precioClasificacion;
      //precioMenores = precioProgM || 0;
      clasificacion = clasificacionT;
      boletosDisponibles = bolDisponibles;
      clasificacion_id = id_clasificacion;
      contenido = cont;
      
      let datosForm = new FormData();
      datosForm.append( "ID_CLASIFICACION", id_clasificacion );
      datosForm.append( "EVENTO_ID", 1 );
  
      
      $.ajax({
        type: 'POST',
        url:  ruta,
        data: datosForm,
        processData: false,
        contentType: false,
        success: function( datos ){
          
          $("#cantidadBoletos").attr({
            // "max" : datos[0].BOLETOS_DISPONIBLES
            "max" : (boletosDisponibles/contenido)
          });

          //$("#cantidadBoletos").val(boletosDisponibles);
          //$("#cantidadBoletos").prop('disabled', true);
  
          $("#clasificacionPrecio").html( "Precio unitario: $" + precioClasificacion.toFixed(2));
          $("#clasificacionTexto").html( "Clasificación: " + clasificacion );
          $("#maximoBoletos").html( "Boletos disponibles: " + boletosDisponibles );  
  
          $("#panel1").fadeOut(100);
          // $("#panel1").hide();
          if('C' == 'C')
          {
                console.log("Tipo acceso cata");
                console.log("Tipo de acceso ACCESO "+'');
                console.log("Leyenda clasificacion "+clasificacion);
            //if(('' == 'USUARIO' && clasificacion == 'PREMIUM') || '' != 'USUARIO' && clasificacion != 'PREMIUM')
            if(clasificacion != 'PREMIUM')
            {
                console.log("Cumple condición para mostrar boletos");
                
                $('#seccionBoletosMenores').empty();
                $('#seccionBoletosMenores').append(
                  `<h4 class="fw-light" style="text-align: center;">
                    Entradas menores (12-17 años):
                  </h4>
                  <h5 id="clasificacionPrecio" class="fw-light col-sm-12 col-md-4 text-center my-2"> Precio unitario: ${precioMenores} </h5>
                  <div class="inputField col-sm-12 col-md-8 my-2">
                          <input id="cantidadBoletosMenores" class=" fw-light col-sm-12 col-md-8 my-2 form-control boletos"
                          type="number" style="text-align: end!important;" min="0" placeholder="Cantidad de boletos menores" inputmode="numeric"/>
                          <div id="mensajeAlerta" class="alert alert-danger" style="display: none;" role="alert">
                            Selecciona una cantidad que esté dentro del rango de boletos disponibles.
                          </div>
                  </div>
                  `
                );
                $("#cantidadBoletosMenores").on('input',inputBoletos);
            }
            
          }
          // else
          // {
  
          // }
          $("#panel2").delay(100).fadeIn(100);
          // $("#panel2").show();
  
          CerrarModal(); // CERRAR MODAL CARGANDO
  
        },
        error: function (response) {
          alert("error: " + response.data);
          CerrarModal(); // CERRAR MODAL CARGANDO
  
        }
      });
    }



  }

    // ---------------------------------------------------------------------
  function panelConfirmar()
  {
    /* console.log(`Array
(
    [__ci_last_regenerate] => 1720108637
    [_ci_previous_url] => https://boletos.vinosparvada.com/index.php/Calendario/index
    [precio_prog_a] => 900.00
    [precio_prog_m] => 
    [tope_entradas] => 18
    [evento] => 1
    [tipo] => C
    [fecha] => 2024-07-04
    [hora] => 18:00:00
    [tope_boletos] => 18
    [precio] => 900.00
    [precio_menores] => 
)
`);//*/

    let bodyConfirmar = document.getElementById("bodyConfirmacion");
    
    while (bodyConfirmar.hasChildNodes()) 
    {
      bodyConfirmar.removeChild( bodyConfirmar.firstChild );
    }

    $("#bodyConfirmacion").append(`
    <fieldset>
      <div class="d-flex">
        <legend class="" style="width:50%;">Datos Personales:</legend>
              </div>

      <div class="row">
        <div class="col-sm-12 col-md-12">
          <label for="nombre">Nombre completo: <span style="color:red;">*</span></label>
          <input data-conekta="card[name]" value="" name="name" type="text" id="nombre" class="form-control"/>
        </div>
        <div class="col-sm-12 col-md-12">
          <label for="correo">Número telefónico (10 digitos): <span style="color:red;">*</span></label>
          <input type="text" value="" maxlength="10" id="numeroTel" class="form-control" oninput="this.value = this.value.replace(/[^0-9]/g,'')"/>
        </div>
        <div class="col-sm-12 col-md-6">
          <label for="correo">Correo electrónico: <span style="color:red;">*</span></label>
          <input type="email" value="" id="correo" class="form-control"/>
        </div>
        <div class="col-sm-12 col-md-6">
          <label for="correo2">Reingresa el correo electrónico: <span style="color:red;">*</span></label>
          <input type="email" value="" id="correo2" class="form-control"/>
        </div>
        <!-- <div class="col-sm-12 col-md-6"> -->
        <!--  <br> -->
        <!--  <label for="facturar">Requiero factura:</label> -->
        <!--  <input type="checkbox" class="form-check-input" name="checkFacturar" id="checkFacturar" onchange="facturarCheck()"> -->
        <!-- </div> -->
      </div>

        <div class="pt-2" style="margin-bottom: -10px;">
            <span style="color:red;">*</span> - Campos obligatorios
        </div>
        <div id="panelAlertas"></div>

        <div id="datosFiscales" style="display:none;">
          <br>
          <div class="row">
            <div class="col-sm-12 col-md-6">
              <br>
              <label for="modDatosFisc">Modificar datos fiscales:</label>
              <input type="checkbox" class="form-check-input" name="checkModDF" id="checkModDF" onchange="modificarDFCheck()">
            </div>
            <div class="d-flex">
            <legend class="" style="width:50%;">Datos Fiscales:</legend>
            </div>
            <div class="col-sm-12 col-md-6">
              <label for="RFC">RFC: <span style="color:red;">*</span></label>
              <input name="RFC" type="text" id="RFC" class="form-control" maxlength="13"/>
            </div>
            <div class="col-sm-12 col-md-12">
              <label for="nombre">Nombre completo: <span style="color:red;">*</span></label>
              <input value="" name="name" type="text" id="nombreF" class="form-control"/>
            </div>
            <div class="col-sm-12 col-md-6">
              <label for="calle">Calle: <span style="color:red;">*</span></label>
              <input name="calleF" type="text" id="calleF" class="form-control"/>
            </div>
            <div class="col-sm-12 col-md-3">
              <label for="numeroF">Número: <span style="color:red;">*</span></label>
              <input name="numeroF" type="text" id="numeroF" class="form-control"/>
            </div>
            <div class="col-sm-12 col-md-3">
              <label for="cpF">C.P.: <span style="color:red;">*</span></label>
              <input name="cpF" type="text" id="cpF" class="form-control" maxlength="5" oninput="this.value = this.value.replace(/[^0-9]/g,'')"/>
            </div>
            <div class="col-sm-12 col-md-6">
              <label for="coloniaF">Colonia: <span style="color:red;">*</span></label>
              <input name="coloniaF" type="text" id="coloniaF" class="form-control"/>
            </div>
            <div class="col-sm-12 col-md-4">
              <label for="paisF">País: <span style="color:red;">*</span></label>
              <select id="paisF" onchange="cargarEstados()" class="form-select">
              <!-- <select id="paisF" class="form-select"> -->
                <option value="D" selected>Selecciona el país</option>
              </select>
            </div>
            <div class="col-sm-12 col-md-4">
              <label for="estadoF">Estado: <span style="color:red;">*</span></label>
              <select id="estadoF" class="form-select" onchange="cargarCiudades()">
              <!-- <select id="estadoF" class="form-select"> -->
              </select>
            </div>
            <div class="col-sm-12 col-md-4">
              <label for="ciudadF">Ciudad: <span style="color:red;">*</span></label>
              <select id="ciudadF" class="form-select">
              </select>
            </div>
            <div class="col-sm-12 col-md-6">
              <label for="personaF">Tipo de persona: <span style="color:red;">*</span></label>
              <select id="personaF" onchange="regimenFiscal()" class="form-select">
                <option value="D" selected>Selecciona el tipo de persona</option>
                <option value="F">Física</option>
                <option value="M">Moral</option>
              </select>
            </div>
            <div class="col-sm-12 col-md-6">
              <label for="regimenF">Régimen Fiscal: <span style="color:red;">*</span></label>
              <select id="regimenF" class="form-select" onchange="usosCFDI()">
                <option value="D" selected>Selecciona el régimen fiscal</option>
              </select>
            </div>
            <div class="col-sm-12 col-md-6">
              <label for="usosCFDI">Uso CFDI: <span style="color:red;">*</span></label>
              <select id="usosCFDI" class="form-select">
                <option value="D" selected>Selecciona el uso CFDI</option>
              </select>
            </div>
          </div>
          <div id="scriptSelects"></div>
        </div>
    </fieldset>

    <hr>
    <fieldset>
      <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-6 p-2 d-flex">
          <h5>Evento: </h5>
          <span> &nbsp; ${eventoNombre} </span>
        </div>

        <div class="col-sm-12 col-md-12 col-lg-6 p-2 d-flex">
          <h5>Fecha: </h5> 
          <span> &nbsp; ${eventoFecha} ${eventoHora.substr(0,5)} Hrs</span>
        </div>

        <div class="col-sm-12 col-md-12 col-lg-6 p-2 d-flex">
          <h5>Cantidad de boletos a comprar:</h5> 
          <span> &nbsp; ${((cantidadBoletos + cantidadBoletosMenores + cantidadBoletosParvaditos) * contenido)}</span>
        </div>

        <div class="col-sm-12 col-md-12 col-lg-6 p-2 d-flex">
          <h5>Subtotal: </h5>
          <span> &nbsp; $${total.toFixed(2)} MXN</span>
        </div>
      </div>
    </fieldset>

    <hr>

    <div>
      <div class="form-check d-flex justify-content-center" >
        <input type="checkbox" class="form-check-input" name="TYC" id="TYC" value="checkedValue">
        <label for="TYC" class="form-check-label" style="align-self: flex-end;">He leído y acepto la 
          <a href="https://vinosparvada.com/es/cancellations" target="_blank" style="color:#0d6efd!important;">politíca de cancelación.</a>
        </label>
      </div>
    </div>
    `);
  }

  function facturarCheck()
  {
    if($("#checkFacturar").is(":checked"))
    {
      $("#datosFiscales").show('slow');

      getDatosFiscales();
    }
    else
    {
      $("#datosFiscales").hide('slow');
      $("#datosFiscales").empty();
    }
  }

  function modificarDFCheck()
  {
    if($("#checkModDF").is(":checked"))
    {
      paisSel = 0;
      estadoSel = 0;
      ciudadSel = 0;
      claveFiscal = 0;
      claveUsoCFDI = 0;
      console.log("Checado");
      datosFModificados = true;
      $("#RFC").prop('disabled', false);
      $("#nombreF").prop('disabled', false);
      $("#calleF").prop('disabled', false);
      $("#numeroF").prop('disabled', false);
      $("#cpF").prop('disabled', false);
      $("#coloniaF").prop('disabled', false);
      $("#paisF").prop('disabled', false);
      $("#estadoF").prop('disabled', false);
      $("#ciudadF").prop('disabled', false);
      $("#personaF").prop('disabled', false);
      $("#regimenF").prop('disabled', false);
      $("#usosCFDI").prop('disabled', false);
    }
    else
    {
      console.log("No checado");
      $("#RFC").prop('disabled', true);
      $("#nombreF").prop('disabled', true);
      $("#calleF").prop('disabled', true);
      $("#numeroF").prop('disabled', true);
      $("#cpF").prop('disabled', true);
      $("#coloniaF").prop('disabled', true);
      $("#paisF").prop('disabled', true);
      $("#estadoF").prop('disabled', true);
      $("#ciudadF").prop('disabled', true);
      $("#personaF").prop('disabled', true);
      $("#regimenF").prop('disabled', true);
      $("#usosCFDI").prop('disabled', true);
    }
  }

  function getDatosFiscales()
  {
    let ruta = "https://boletos.vinosparvada.com/Usuarios/obtenerDatosFiscales";
    let datos = "";
    console.log("GET DATOS FISCALES");
      $.ajax({
        type: 'GET',
        url:  ruta,
        processData: false,
        contentType: false,
        success: function( datos ){
          
          //if(datos.DATOS_FISCALES_ID != 0)
          if(datos.ESTATUS == 'OK')
          {
            console.log('NO TIENE DATOS FISCALES');
            cargarPaises();
          }
          else
          {            
            console.log(datos);
            //let datos = datosDecoded[0];
            $("#RFC").prop('disabled', true);
            $("#nombreF").prop('disabled', true);
            $("#calleF").prop('disabled', true);
            $("#numeroF").prop('disabled', true);
            $("#cpF").prop('disabled', true);
            $("#coloniaF").prop('disabled', true);
            $("#paisF").prop('disabled', true);
            $("#estadoF").prop('disabled', true);
            $("#ciudadF").prop('disabled', true);
            $("#personaF").prop('disabled', true);
            $("#regimenF").prop('disabled', true);
            $("#usosCFDI").prop('disabled', true);

            $("#RFC").val(datos.RFC);
            $("#nombreF").val(datos.NOMBRE_FISCAL);
            $("#calleF").val(datos.DIRECCION);
            $("#numeroF").val(datos.NUMERO);
            $("#cpF").val(datos.DOMICILIO_FISCAL);
            $("#coloniaF").val(datos.COLONIA);

            paisSel = datos.PAIS_ID;
            cargarPaises();

            estadoSel = datos.ESTADO_ID;
            cargarEstados();

            ciudadSel = datos.CIUDAD_ID;
            cargarCiudades();
            
            $("#personaF").val(datos.TIPO_PERSONA);

            claveFiscal = datos.CLAVE;
            regimenFiscal();
            
            claveUsoCFDI = datos.CLAVE_USOCFDI;
            //$("#usosCFDI").val(datos.CLAVE_USOCFDI);
            console.log("Clave Fiscal recuperada BD " + claveFiscal);
            
            setTimeout(function(){
              usosCFDI();
            }, 2000);
            //$("#regimenF").val(datos.CLAVE);
          }
        }
      });
      
      $("#scriptSelects").append(`<script> async function rellenarDatos(pais, estado, ciudad, paisVar)
      {
        console.log("PAIS "+pais+" ESTADO "+estado+" CIUDAD "+ciudad);
        await cargarPaises(pais);
        console.log("Países cargados 2");
        //$("#paisF").val(pais).change();
        
        // let elemento = document.getElementById('paisF');
        // console.log(elemento);
        // elemento.value = 6;
        // elemento.dispatchEvent(new Event('change'));
        await cargarEstados();
        setTimeout(function(){
          $("#estadoF").val(estado).change();
        }, 2000);
        
      } `);
  }

  function cargarPaises()
  {
    let ruta = "https://boletos.vinosparvada.com/Clientes/cargarPaises";
    $("#paisF").empty();
    $("#paisF").append(`<option value="D" selected>Selecciona el país</option>`);
    $("#estadoF").empty();
    $("#ciudadF").empty();

    $.ajax({
    url: ruta,
    type: 'GET',
    success: function( paises ){
      for ( let pais of paises)
      {
        if(pais.PAIS_ID == paisSel)
        {
          $("#paisF").append(`
          <option value="${pais.PAIS_ID}" selected>${pais.NOMBRE}</option>
          `);
        }
        else
        {
          $("#paisF").append(`
          <option value="${pais.PAIS_ID}">${pais.NOMBRE}</option>
          `);
        }
      }
      }
    });
  }

  function cargarEstados()
  {
    let ruta = "https://boletos.vinosparvada.com/Clientes/cargarEstados";
    if(estadoSel == 0)
    {
      paisSel = $("#paisF").val();
    }

    $("#estadoF").empty();
    $("#estadoF").append(`<option value="D" selected>Selecciona el estado</option>`);
    
    $.ajax({
      url: ruta,
      type: 'POST',
      data: {'PAIS_SELECCIONADO':paisSel},
      success: function( estados ){
        for ( let estado of estados)
        {
          if(estado.ESTADO_ID == estadoSel)
          {
            $("#estadoF").append(`
            <option value="${estado.ESTADO_ID}" selected>${estado.NOMBRE}</option>
            `);
          }
          else
          {
            $("#estadoF").append(`
            <option value="${estado.ESTADO_ID}">${estado.NOMBRE}</option>
            `);
          }
          
        }
      }
    });
  }

  function cargarCiudades()
  {
    let ruta = "https://boletos.vinosparvada.com/Clientes/cargarCiudades";
    if(ciudadSel == 0)
    {
      estadoSel = $("#estadoF").val();
    }

    $("#ciudadF").empty();
    $("#ciudadF").append(`<option value="D" selected>Selecciona la ciudad</option>`);

    $.ajax({
      url: ruta,
      type: 'POST',
      data: {'ESTADO_SELECCIONADO':estadoSel},
      success: function( ciudades ){
        for ( let ciudad of ciudades)
        {
          if(ciudad.CIUDAD_ID == ciudadSel)
          {
            $("#ciudadF").append(`
            <option value="${ciudad.CIUDAD_ID}" selected>${ciudad.NOMBRE}</option>
            `);
          }
          else
          {
            $("#ciudadF").append(`
            <option value="${ciudad.CIUDAD_ID}">${ciudad.NOMBRE}</option>
            `);
          }
        }
      }
    });
  }

  function regimenFiscal()
  {
    let ruta = "https://boletos.vinosparvada.com/Clientes/RegimenesFiscales";
    let tipoPersona = $("#personaF").val();

    $("#regimenF").empty();
    $("#regimenF").append(`<option value="D" selected>- Selecciona el régimen fiscal -</option>`);

    $.ajax({
      url: ruta,
      type: 'POST',
      data: {'TIPO_PERSONA':tipoPersona},
      success: function( regimenes ){
        for ( let regimen of regimenes)
        {
          if(regimen.CLAVE == claveFiscal)
          {
            $("#regimenF").append(`
            <option value="${regimen.CLAVE}" selected>${regimen.NOMBRE}</option>
            `);
          }
          else
          {
            $("#regimenF").append(`
            <option value="${regimen.CLAVE}">${regimen.NOMBRE}</option>
            `);
          }
        }
      }
    });
  }

  function usosCFDI()
  {
    let ruta = "https://boletos.vinosparvada.com/Clientes/UsosCFDI";
    let claveFiscal = $('#regimenF').val();
    let tipoPersona = $("#personaF").val();
    console.log("Regimen seleccionado " + claveFiscal);

    $("#usosCFDI").empty();
    $("#usosCFDI").append(`<option value="D" selected>- Selecciona el uso CFDI -</option>`);
    
    $.ajax({
      url: ruta,
      type: 'POST',
      data: {'REGIMEN_FISCAL': claveFiscal,
             'TIPO_PERSONA': tipoPersona},

      success: function( usosCFDI )
      {
        for( let usoCFDI of usosCFDI )
        {
          if(usoCFDI.CLAVE_CFDI == claveUsoCFDI)
          {
            $("#usosCFDI").append(`<option value="${usoCFDI.CLAVE_CFDI}" selected>${usoCFDI.DESCRIPCION}</option>`);
          }
          else
          {
            $("#usosCFDI").append(`<option value="${usoCFDI.CLAVE_CFDI}">${usoCFDI.DESCRIPCION}</option>`);
          }
        }
      }
    });
  }

  function checkCampos()
  {
    $("#cerrarModalConfirmar").click();

    nombre_usuario = $("#nombre");
    correo_usuario = $("#correo");
    correo_confirmar = $("#correo2");
    telefono_usuario = $("#numeroTel");
    politica_check = $("#TYC");
    
    let ejecQuery = true;
    
    if ( nombre_usuario.val() == "") {
      nombre_usuario.addClass("error");
      CerrarModal();
      ejecQuery = false;
    }
    if ( correo_usuario.val() == "") {
      correo_usuario.addClass("error");
      CerrarModal();
      ejecQuery = false;
    }

    if ( telefono_usuario.val() == "" || telefono_usuario.val().length < 10 || telefono_usuario.val().length > 10 ) {
      telefono_usuario.addClass("error");
      CerrarModal();
      ejecQuery = false;
    }

    if ( correo_usuario.val() != correo_confirmar.val() ) {
      correo_confirmar.addClass("error");
      let panelAlertas = $("#panelAlertas");
      panelAlertas.empty();
      panelAlertas.append(`<div class="alert alert-warning my-1" style="text-align: center;" role="alert">
                              ¡Los correos no coinciden!
                            </div>`
      );
      ejecQuery = false;
      CerrarModal();
    }

    if ( ! politica_check.is(':checked') ) {
      politica_check.addClass("error");
      alert("Favor de aceptar la politica de cancelacion.");
      CerrarModal();
      ejecQuery = false;
    }

    return ejecQuery;
  }

  function crearDatosClienteConekta()
  {
    let ejecQuery = checkCampos();
    let descripcionCargo = eventoNombre+' '+eventoFecha+' '+eventoHora;

    if (!ejecQuery) {
      //console.log("No ejecutó función");
      return 0;
    } 
    //console.log("Siguió ejecución");
    let panelAlertas = $("#panelAlertas");
    panelAlertas.empty();
    nombre_usuario.removeClass("error");
    correo_usuario.removeClass("error");
    correo_confirmar.removeClass("error");
    telefono_usuario.removeClass("error");

    if(totalAdultos > 0 && totalMenores == 0)
    {
      itemsOrdenCompra = [{
        'name':descripcionCargo,
        'unit_price': ( (precioSeleccionado * 100)),
        'quantity': (cantidadBoletos * contenido)
      }];
    }    
    else if(totalAdultos > 0 && totalMenores > 0)
    {
      itemsOrdenCompra = [{
        'name':descripcionCargo,
        'unit_price': (precioSeleccionado*100),
        'quantity': cantidadBoletos
      }
      ,
      {
        'name':descripcionCargo,
        'unit_price': (precioMenores*100),
        'quantity': cantidadBoletosMenores
      }];
    }

    let datosCustomer = new FormData();
    datosCustomer.append( "NOMBRE", $("#nombre").val() );
    datosCustomer.append( "CORREO", $("#correo").val() );
    datosCustomer.append( "TELEFONO", $("#numeroTel").val() );
    datosCustomer.append( "FECHA_HORA_BOLETOS", descripcionCargo)    
    datosCustomer.append( "ITEMS_COMPRA", JSON.stringify(itemsOrdenCompra) );

    //console.log("Crear datos cliente coneckta");
    //let printedObject = JSON.stringify(datosSesion);
    //console.log(printedObject);

    //if ( datosSesion && (datosSesion.hasOwnProperty("id") || datosSesion.hasOwnProperty("sub")) )
    //sesionIniciadaGoogle = '';
    //sesionIniciadaFB = '';
    // console.log("Impresion de sesiones");
    // console.log(sesionIniciadaFB);
    // console.log(sesionIniciadaGoogle);

    if(sesionIniciadaFB || sesionIniciadaGoogle)
    {
      if(sesionIniciadaFB) //INICIO CON FACEBOOK
      {
        var datosActualizar = {
          CORREO: $("#correo").val(),
          TELEFONO: $("#numeroTel").val(),
          FB_ID: 'TRUE',
          GOOGLE_ID: ''
        }
      }
      else if(sesionIniciadaGoogle) //INICIO CON GOOGLE
      {
        //console.log("Has own property SUB (google) " + google_id);
        var datosActualizar = {
          CORREO: $("#correo").val(),
          TELEFONO: $("#numeroTel").val(),
          FB_ID: '',
          GOOGLE_ID: 'TRUE'
        }
      }

      $.ajax(
      {
        url: "https://boletos.vinosparvada.com/Clientes/ActualizarClienteCompra",
        type:"POST",
        data: datosActualizar,
        success: function( res )
        {
          let estatus = res.ESTATUS || "ERROR";
  
          if (estatus == "CORREO") 
          {
            $("#mensajeCorreo").empty();
            $("#mensajeCorreo").append(`<div class="alert alert-warning my-1" style="text-align: center;" role="alert">
                                ${res.MSG}
                              </div>`);
          }
  
          if (estatus == "ERROR") 
          {
            $("#panelAlertas").empty();
            $("#panelAlertas").append(`<div class="alert alert-warning my-1" style="text-align: center;" role="alert">
                                Ocurrio un error: ${res.MSG}
                              </div>`);
            CerrarModal();
          }
          else{
            console.log("entro a customer if id");

            $("#panelAlertas").empty();
            prepararConekta(datosCustomer);
            $("#panel3").fadeOut(100);
            $("#panel4").delay(100).fadeIn(100);
  
          }
  
          
        },
        error:function( res )
        {
          console.log(res);
          $("#panelAlertas").empty();
          $("#panelAlertas").append(`<div class="alert alert-warning my-1" style="text-align: center;" role="alert">
                                Ocurrio un error. ${res.MSG}
                              </div>`);
          CerrarModal();
        }
  
      });
      
    }
    else{
      console.log("entro a customer else");
      prepararConekta(datosCustomer);
    }

    
  }

  // ---------------------------------------------------------------------
  function MostrarModal(){
    
    $("#staticBackdrop").modal("show");
  }
  function CerrarModal(){

    $("#staticBackdrop").modal("hide");
  }
  // ---------------------------------------------------------------------
  iniciarEvento();
  // ---------------------------------------------------------------------
  let ruta_img_recorrido = "";

  function iniciarEvento()
  {
    let urlInformacionEvento = "https://boletos.vinosparvada.com/Eventos/getInformacionEvento";

    $.ajax({
      type: "POST",
      //data: {"EVENTO_ID": ,
      //        "TIPO_EVENTO":}
      url:  urlInformacionEvento,
      success: function ( evento ) {
        
        if (evento.length > 0) {          
          eventoNombre = evento[0].DESCRIPCION;
          eventoFecha  = evento[0].FECHA;
          eventoHora = evento[0].HORA_INICIO;
          horarioElegido = evento[0].EVENTO_HORARIO_ID;
          ruta_img_recorrido = evento[0].IMG_RECORRIDO;

          cliente_id = 0;
          
          panelImagenEvento.append(`
          <div class="card deshabilitar shadowImg">
          <img
          class="card-img w-100 d-block cartaImagen shadow-sm rounded"
          src="https://boletos.vinosparvada.com${evento[0].IMG_PRESENTACION}"
          />
          
          <div class="card-img-overlay text-center colorContrario">
          <h4 class="text-center tituloEvento">
          ${evento[0].DESCRIPCION}
          </h4>
          <p class="lead descripcionEvento">
          ${evento[0].FECHA}
          </p>
          </div>
          </div>
          `);
          
          iniciarClasificaciones();
        }
        else{
          container.append(`<h2 class=" section-heading">
              Ocurrió un problema al mostrar los datos...
            </h2>
            <h3>
              Vuelve en un tiempo para actualizaciones.
            </h3>`);
            CerrarModal();
        }
      },
      error: function () {
        container.append(`
        <h2 class=" section-heading">
          Ocurrió un problema al mostrar los datos...
        </h2>
        <h3>
          Vuelve en un tiempo para actualizaciones.
        </h3>
        `);
        CerrarModal();

      }

    })
  }
  // ---------------------------------------------------------------------
  function crearClienteUsuario()
  {
    $("#cerrarModalConfirmar").click();
    let nombre_usuario = $("#nombre");
    let correo_usuario = $("#correo");
    let correo_confirmar = $("#correo2");
    let telefono_usuario = $("#numeroTel");
    let politica_check = $("#TYC");
    let ejecQuery = true;
    
    if ( nombre_usuario.val() == "") {
      nombre_usuario.addClass("error");
      CerrarModal();
      ejecQuery = false;
      return false;
    }
    if ( correo_usuario.val() == "") {
      correo_usuario.addClass("error");
      CerrarModal();
      ejecQuery = false;
      return false;
    }
    if ( telefono_usuario.val() == "" || telefono_usuario.val().length < 10 || telefono_usuario.val().length > 10 ) {
      telefono_usuario.addClass("error");
      CerrarModal();
      ejecQuery = false;
      return false;
    }

    if ( correo_usuario.val() != correo_confirmar.val() ) {
      correo_confirmar.addClass("error");
      let panelAlertas = $("#panelAlertas");
      panelAlertas.empty();
      panelAlertas.append(`<div class="alert alert-warning my-1" style="text-align: center;" role="alert">
                              ¡Los correos no coinciden!
                            </div>`
      );
      ejecQuery = false;
      CerrarModal();
      return false;
    }

    if ( ! politica_check.is(':checked') ) {
      politica_check.addClass("error");
      alert("Favor de aceptar la política de cancelación.");
      CerrarModal();
      ejecQuery = false;
    }
    
    nombre_usuario.removeClass("error");
    correo_usuario.removeClass("error");
    correo_confirmar.removeClass("error");
    telefono_usuario.removeClass("error");

    // let datosForm = new FormData();
    // datosForm.append( "CORREO_USUARIO", correo_usuario.val() );

    if(ejecQuery == true){
      let ruta = "https://boletos.vinosparvada.com/Clientes/CrearClienteUsuario";
  
      $.ajax({
        url:ruta,
        type:"POST",
        data:{ 
          NOMBRE_USUARIO: nombre_usuario.val(), 
          CORREO_USUARIO: correo_usuario.val(), 
          TELEFONO_USUARIO: telefono_usuario.val() 
        },
        success: function( res ){
          let estatus = res.ESTATUS || "ERROR";
          console.log(res);
          if (estatus == "OK") {
            
            // CHECKBOX OMITIR PAGO
            if ( $("#omitirPago").is(':checked') ) {
              cliente_id = res.CLIENTE_ID;
              omitirPagoUsuario();
              $("#btnConfirmacion").prop('disabled', true);
            }
            else{
              cliente_id = res.CLIENTE_ID;
              // crearDatosClienteConekta();
              // $("#panel3").fadeOut(100);
              // $("#panel4").delay(100).fadeIn(100);
              //crearDatosClienteConekta();
              console.log("NO SE OMITE PAGO");
              if(procesadorPredet == 'CONEKTA')
              {
                console.log("Conekta predeterminado");
                crearDatosClienteConekta();
              }
              else if(procesadorPredet == 'OPENPAY')
              {
                console.log("Openpay predeterminado");
                crearDatosOpenPay();
              }
              $("#panel3").fadeOut(100);
              $("#panel4").delay(100).fadeIn(100);
            }
            

          }
          else{
            CerrarModal();
            let panelAlertas = $("#panelAlertas");
            panelAlertas.empty();
            panelAlertas.append(`<div class="alert alert-danger my-1" style="text-align: center;" role="alert">
                              Ocurrió un problema al validar los datos, verifica que el correo sea tuyo.
                            </div>`);
          }
        },
        error:function(){
          alert("Ocurrió un problema al conectar con el servidor. Vuelve a intentarlo en un momento.")
          CerrarModal();
        }
      })
    }
    else
    {
      return false;
    }

  }
  // ---------------------------------------------------------------------
  var boletosMenores = [];

  function iniciarClasificaciones()
  {
    let urlInformacionClasificaciones = "https://boletos.vinosparvada.com/Eventos/getClasificacionesEvento";
    
    $.ajax({
      type: "GET",
      url:  urlInformacionClasificaciones,
      success: function ( clasificaciones ) {
        console.log(clasificaciones);
        let detallesClasificaciones = ``;

        let vendidosC = clasificaciones[clasificaciones.length - 1];
        console.log("VENDIDOS DESDE ARREGLO " + vendidosC);

        if ( clasificaciones.ESTATUS && clasificaciones.ESTATUS == "ERROR" ) 
        {
          panelDetallesEvento.append(` 
          <h2 class=" section-heading">
            ${clasificaciones.MSG}
          </h2>
          <h3>
            Vuelve en un tiempo para actualizaciones.
          </h3>`);

          CerrarModal();

          return;
        }
        //for ( let clasificacion of clasificaciones)
        for(let i = 0; i < clasificaciones.length - 1; i++)
        {
          let clasificacion = clasificaciones[i];
          if('C' == 'C')
          {
            precioProgA = 900.00;
            precioProgM = 0;
            //topeBProg   = 18;
            topeBProg = clasificacion.TOPE_BOLETOS;
            console.log("TOPE BOLETOS DESDE CLASFICACION "+topeBProg);
            //console.log("TOPE DESDE SESION" + topeBProg);
            if(clasificacion.DESCRIPCION != 'PARVADITOS' && clasificacion.DESCRIPCION != 'MENORES DE 12 AÑOS')
            {
              topeBProg = topeBProg - vendidosC;
              console.log("BOLETOS RESTANTES " + topeBProg);
              detallesClasificaciones += `
              <div id="${clasificacion.CID}" class="btn btn-${topeBProg > 0 ? 'light' : 'secondary disabled'}  border border-4 d-block mx-3 py-3" 
                    onclick="getBoletosClasificacion(${clasificacion.CID},${clasificacion.PRECIO},'${clasificacion.DESCRIPCION}',${topeBProg}, 1)">
                  <div class="d-flex justify-content-between">
                    <span class="mx-1" style="align-self: center; text-align:start;">
                      ACCESO ${clasificacion.DESCRIPCION}
                    </span>
                    <div class="row">
                      <span class="mx-1 col-12" style="align-self: center;">
                        MX$${clasificacion.PRECIO}
                      </span>
                      <span class="mx-1 col-12 fw-light" style="align-self: center;">
                        ${
                          topeBProg > 0 
                          ? 'Boletos Disponibles: '+topeBProg
                          : 'No hay boletos Disponibles'
                        }
                      </span>

                        </div>

                      </div>
                    </div>
              `;
            }
            else if(clasificacion.DESCRIPCION == 'PARVADITOS')
            {
              parvaditos = true;
              clasificacionParvaditos = clasificacion.CID;
              precioParvaditos = clasificacion.PRECIO;
              $('#incluirParvaditos').show();
            }
            else if(clasificacion.DESCRIPCION == 'MENORES DE 12 AÑOS')
            {
              console.log("SE SETEA VARIABLE CLASIFICACION MENORES EN INICIAR CLASIFICACIONES");
              boletosMenores = clasificacion;
              clasificacionMenores = clasificacion.CID;
              precioMenores = clasificacion.PRECIO;
            }
          }
          else
          {
            detallesClasificaciones += `
              <div id="${clasificacion.CID}" class="btn btn-light  border border-4 d-block mx-3 py-3 ${clasificacion.DISPONIBLES > 0 ? '' : 'disabled'}" 
                    onclick="getBoletosClasificacion(${clasificacion.CID},${clasificacion.PRECIO},'${clasificacion.DESCRIPCION}',${clasificacion.DISPONIBLES}, ${clasificacion.CONTENIDO})">
                      <div class="d-flex justify-content-between">
                        <span class="mx-1" style="align-self: center; text-align:start;">
                          ${clasificacion.DESCRIPCION}
                        </span>
                        <div class="row">
                          <span class="mx-1 col-12" style="align-self: center;">
                            MX$${clasificacion.PRECIO}
                          </span>
                          <span class="mx-1 col-12 fw-light" style="align-self: center; display:none;">
                            Boletos Disponibles: ${clasificacion.DISPONIBLES}
                          </span>

                        </div>

                      </div>
                    </div>
              `;
          }
        }
        panelDetallesEvento.append(`
        <div id="panel1" class="container shadow shadow-1 pb-3" style="background-color: #eee!important;">
          <h3 class="p-2">Clasificaciones</h3>
          ${detallesClasificaciones}
        </div>
        `);

        if('C' == 'C'){
          if (ruta_img_recorrido != null || ruta_img_recorrido != "") 
          {  
            panelDetallesEvento.append(`
            <hr>
            <div class="mt-3" id="panelImgRecorrido">
                <img loading="lazy" id="imagenRecorrido" class="card-img mx-auto shadowImg" 
                    style="display:block; width:75%; padding:5px; border: 1px solid #ddd;border-radius: 4px;" 
                    src="https://boletos.vinosparvada.com/${ruta_img_recorrido}" onerror="quitarSeccionImagenRecorrido()">
            </div>
          `);
          }
          else{
            quitarSeccionImagenRecorrido();
          }
        }

        CerrarModal();

      },
      error: function(){
        panelDetallesEvento.append(`
        <h2 class=" section-heading">
          Ocurrió un problema al mostrar los datos...
        </h2>
        <h3>
          Vuelve en un tiempo para actualizaciones.
        </h3>
        `);

        CerrarModal();

      }

    })
  }
  // ---------------------------------------------------------------------
  function omitirPagoUsuario()
  {
    let ruta = "https://boletos.vinosparvada.com/Eventos/pagoCompra2";
    let cortesia = "";
  
    let datosForm = new FormData();
    datosForm.append( "EVENTO_ID", 1 );
    datosForm.append( "CANTIDAD_BOLETOS", (cantidadBoletos * contenido ) );
    datosForm.append( "CANTIDAD_BOLETOS_MENORES", cantidadBoletosMenores );
    datosForm.append( "CANTIDAD_BOLETOS_PARVADITOS", cantidadBoletosParvaditos );
    datosForm.append( "CLASIFICACION", clasificacion_id );
    datosForm.append( "CLASIFICACION_MENORES", clasificacionMenores );
    datosForm.append( "CLASIFICACION_PARVADITOS", clasificacionParvaditos );
    datosForm.append( "PRECIO_BOLETOS", precioSeleccionado );
    datosForm.append( "PRECIO_BOLETOS_MENORES", precioMenores );
    datosForm.append( "PRECIO_BOLETOS_PARVADITOS", precioParvaditos );
    datosForm.append( "EVENTO_HORARIO_ID", horarioElegido);
    datosForm.append( "CLIENTE_ID" , cliente_id);
    if ( $("#chkCortesia").length > 0 && $("#chkCortesia").is(":checked")  ) 
    {
      cortesia = "S";
    } else {
      cortesia = "N";
    }
    datosForm.append( "CORTESIA", cortesia );
    datosForm.append( "NOMBRE_RECEPTOR", $("#nombre").val() );
    
    $.ajax({
      type: 'POST',
      url:  ruta,
      data: datosForm,
      processData: false,
      contentType: false,
      success: function( datos )
      {
        $("#panel4Botones").empty();
        CerrarModal();
        generarCodigoQR( datos.FOLIO_COMPRA, datos.DETALLE_COMPRA, true );
        //mandarCorreo(true); // true redirecciona a resumen de compra.
      },
      error: function ()
      {
        CerrarModal();
      }
    
    });
  }
  // ---------------------------------------------------------------------
  // METODOS PARA GENERAR EL QR
  function generarCodigoQR(folio_compra, detalle_compra, redireccionar)
  {
    let datosCodigoQR = detalle_compra;

    const qrCode = new QRCodeStyling({
      width: 400,
      height: 400,
      // type: "svg",
      type: "canvas",
      // data: "https://www.facebook.com/",
      data: datosCodigoQR,
      // image: "https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg",
      // image: "descargar.png",
      image: "https://boletos.vinosparvada.com/assets/img/imagenQR.png",
      dotsOptions: {
          color: "#000000",
          type: "square"
      },
      backgroundOptions: {
        "color": "#ffffff"
      },
      imageOptions: {
          crossOrigin: "anonymous",
          margin: 20
      }
    });

    qrCode.append(document.getElementById("canvas"));
    // qrCode.download({ name: "qr", extension: "svg" });
    console.log("terminó");
    setTimeout(() => {
      
      guardarCodigoQR( folio_compra , redireccionar);

    }, 1000);

  }

  function guardarCodigoQR(folio_c, redireccionar)
  {
    let url = 'https://boletos.vinosparvada.com/Eventos/guardarQRCompra';
    let canvas = document.getElementsByTagName("canvas");
    let urlIMG = canvas[0].toDataURL();    
    let img = document.createElement("img");
    img.src = urlIMG;

    //let datosForm = new FormData();
    // datosForm.append("CODIGO_QR", urlIMG);
    // datosForm.append("FOLIO_COMPRA", "");

    $.ajax({
      type:"POST",
      url: url,
      data:{
        CODIGO_QR: img.src,
        FOLIO_COMPRA: folio_c
      },
      success:function(mensaje){
        console.log("creo el codigo: ",mensaje);
        //mandarCorreo(redireccionar);
        // mandarCorreo();
        // mandarMensaje();
      },
      error:function(mensaje){
        console.log(mensaje);
      },
    });
  }

  function procesadorPredeterminado()
  {
    let url = 'https://boletos.vinosparvada.com/Eventos/procesadorPredeterminado';
    let predet = "";

    $.ajax({
      url:url,
      processData: false,
      contentType: false,
      type:"GET",
      async: false,
      success: function ( respuesta )
      {
        predet = respuesta;
      },
      error: function()
      {
        predet = "ERROR";
      }
    });

    return predet;
  }
  

  function mandarCorreo( redireccionar )
  {
      //$("#btnCorreo").addClass("btn-cargando");
      if ( $("#omitirEnvio").is(":checked") && redireccionar ) {

        window.location.href = 'https://boletos.vinosparvada.com/Eventos/resumenCompra';
        return;

      } else if ( $("#omitirEnvio").is(":checked") ) {

        return;
      }

      let url = 'https://boletos.vinosparvada.com/Eventos/mandarCorreo';

      let canvas = document.getElementsByTagName("canvas");
      let urlIMG = canvas[0].toDataURL();

      let img = document.createElement("img");
      img.src = urlIMG;

      // document.body.appendChild(img);
      // document.body.appendChild(img)
      // console.log(img);

      let datosForm = new FormData();
      // datosForm.append( "QR", $("#canvas").html() );
      datosForm.append( "QR", img.outerHTML );

      $.ajax({
        url:url,
        data:datosForm,
        processData: false,
        contentType: false,
        type:"POST",
        success: function ( respuesta ){
          console.log(respuesta);
          let estatus = respuesta.ESTATUS || "ERROR";
          if (estatus == "OK") {
            let tituloToast = "CORREO";
            let mensajeToast = "El correo se ha enviado. Verifica la bandeja."
            mostrarToast( tituloToast, mensajeToast );
            mandarMensaje( redireccionar );
          }
          else{
            let tituloToast = "CORREO";
            let mensajeToast = "Ocurrió un error al enviar el correo, inténtalo de nuevo."
            mostrarToast( tituloToast, mensajeToast );
          }
          //$("#btnCorreo").removeClass("btn-cargando");
        },
        error: function(){
          //$("#btnCorreo").removeClass("btn-cargando");
        }
      })

  }

  function mandarMensaje( redireccionar )
  {
    // if ( !$("#omitirEnvio").is(":checked") ) return;

    let url = 'https://boletos.vinosparvada.com/Eventos/mandarMensaje';

    // let datosForm = new FormData();
    // datosForm.append( "QR", $("#canvas").html() );
    // datosForm.append( "QR", img.outerHTML );

    $.ajax({
      url:url,
      type:"GET",
      success: function ( response ){
        console.log(response);

        let estatus = response.ESTATUS || "ERROR";
        if ( estatus == "OK" ) {
          let tituloToast = "MENSAJE";
          let mensajeToast = "El código se ha enviado a tu WhatsApp.";
          mostrarToast( tituloToast, mensajeToast );
        }
        else{
          let tituloToast = "MENSAJE";
          let mensajeToast = "Ocurrió un problema al enviar el mensaje, inténtalo de nuevo.";
          mostrarToast( tituloToast, mensajeToast );
        }

        if ( redireccionar ) {
          window.location.href = 'https://boletos.vinosparvada.com/Eventos/resumenCompra';
        }

      },
      error: function ( error ){
        console.log(error);
        let tituloToast = "MENSAJE";
        let mensajeToast = "Ocurrió un problema al enviar el mensaje, inténtalo de nuevo.";
        mostrarToast( tituloToast, mensajeToast );
      }
    })

  }

  // function quitarSeccionImagenRecorrido()
  // {
  //   $("#panelImgRecorrido").empty();
  // }

  //METODOS QUE NO SE USAN
  function procesarDatosPago()
  {
    let validarCorreo = /^\S+@\S+\.\S+$/;
    let bandera = true;
    
    nombre =        $("#nombre").val() ;
    correo =        $("#correo").val();
    numTarjeta =    $("#numero").val();
    fechaTarjeta =  $("#fecha").val();
    cvv =           $("#cvv").val();

    if ( nombre.length <= 0 || nombre.length >= 150 ) {
      $("#nombre").addClass("error")
      bandera = false;
    }else{ $("#nombre").removeClass("error") }
    
    if ( !validarCorreo.test( correo ) ) {
      $("#correo").addClass("error")
      bandera = false;
    }else{ $("#correo").removeClass("error") }

    if ( !numTarjeta ) {
      $("#numero").addClass("error")
      bandera = false;
    }else{ $("#numero").removeClass("error") }

    // if ( !fechaTarjeta ) {
    //   $("#fecha").addClass("error")
    //   bandera = false;
    // }else{ $("#fecha").removeClass("error") }

    if ( !cvv ) {
      $("#cvv").addClass("error")
      bandera = false;
    }else{ $("#cvv").removeClass("error") }

    
    console.log(nombre,correo,numTarjeta,fechaTarjeta,cvv);
    return bandera;

  }

  function crearDatosOpenPay()
  {
    let ejecQuery = checkCampos();

    if(ejecQuery)
    {
      $("#conektaIframeContainer").css({"height":"0"});
      $("#panel3").fadeOut(100);
      $("#panel4").delay(100).fadeIn(100);
    
      CerrarModal();
      
      let panelAlertas = $("#panelAlertas");
      panelAlertas.empty();
      nombre_usuario.removeClass("error");
      correo_usuario.removeClass("error");
      correo_confirmar.removeClass("error");
      telefono_usuario.removeClass("error");

      $("#openPayFrameContainer").append(`
      <div class="creditCardForm" id="ccForm">
          <div class="heading">
              <h1>Confirmar compra</h1>
              <div class="alert alert-info" role="alert">
                De momento sólo aceptamos tarjetas Visa/Mastercard.
              </div>      
          </div>
          <div class="payment">
              <form id="payment-form">
                  <input type="hidden" name="token_id" id="token_id">
                  <input type="hidden" name="deviceIdHiddenFieldName" id="deviceIdHiddenFieldName">
                  <div class="form-group" style="text-align: center; ">
                  <!-- <div style="text-align: center;"> -->
                    <img src="https://public.openpay.mx/images/logos/openpay/logo_login.png">
                  <!-- </div> -->
                  </div>
                  <div class="form-group owner">
                      <label for="owner">Nombre del titular</label>
                      <input type="text" class="form-control" id="owner" placeholder="Como aparece en la tarjeta" autocomplete="off" data-openpay-card="holder_name">
                  </div>                
                  <div class="form-group" id="card-number-field">
                      <label for="cardNumber">Número de tarjeta</label>
                      <input type="text" class="form-control" id="cardNumber" maxlength="16" autocomplete="off" data-openpay-card="card_number">
                  </div>
                  <div class="form-group" id="expiration-date">
                      <label>Fecha de expiración</label>
                      <select data-openpay-card="expiration_month">
                          <option value="01">Enero</option>
                          <option value="02">Febrero </option>
                          <option value="03">Marzo</option>
                          <option value="04">Abril</option>
                          <option value="05">Mayo</option>
                          <option value="06">Junio</option>
                          <option value="07">Julio</option>
                          <option value="08">Agosto</option>
                          <option value="09">Septiembre</option>
                          <option value="10">Octubre</option>
                          <option value="11">Noviembre</option>
                          <option value="12">Diciembre</option>
                      </select>
                      <select data-openpay-card="expiration_year">                          
                          <option value="23">2023</option>
                          <option value="24">2024</option>
                          <option value="25">2025</option>
                          <option value="26">2026</option>
                          <option value="27">2027</option>
                          <option value="28">2028</option>
                          <option value="29">2029</option>
                          <option value="30">2030</option>
                          <option value="31">2031</option>
                          <option value="32">2032</option>
                          <option value="33">2033</option>
                      </select>                    
                  </div>
                  <div class="form-group cvv">
                      <label for="cvv">CVV</label>
                      <input type="text" class="form-control" id="cvv" autocomplete="off" data-openpay-card="cvv2">
                  </div>
                  <div hidden class="form-group parcializacion">
                    <label for="Parcialidades">Parcialidades</label>
                    <select id="parcialidades">
                      <option value="1">Un sólo pago</option>
                      <!-- <option value="3">3 meses sin intereses</option> -->
                      <!-- <option value="6">6 meses sin intereses</option> -->
                      <!-- <option value="9">9 meses sin intereses</option> -->
                      <!-- <option value="12">12 meses sin intereses</option> -->
                      <!-- <option value="18">18 meses sin intereses</option> -->
                    </select>
                  </div>
                  <div class="form-group" id="credit_cards">
                      <!-- <img src="https://public.openpay.mx/images/logos/openpay/logo_login.png"> -->
                      <img src="https://boletos.vinosparvada.com/assets/img/visa.jpg" id="visa">
                      <img src="https://boletos.vinosparvada.com/assets/img/mastercard.jpeg" id="mastercard">
                      <!-- <img src="https://boletos.vinosparvada.com/assets/img/amex.jpg" id="amex"> -->
                  </div>
                  <div class="form-group" id="debit_cards">
                      <img src="https://boletos.vinosparvada.com/assets/img/afirme.png" width = "10%" height = "10%" id="afirme">
                      <img src="https://boletos.vinosparvada.com/assets/img/bancoAzteca.png" width = "10%" height = "10%" id="bancoAzteca">
                      <img src="https://boletos.vinosparvada.com/assets/img/banorte.png" width = "10%" height = "10%" id="banorte">
                      <img src="https://boletos.vinosparvada.com/assets/img/banregio.png" width = "10%" height = "10%" id="banregio">
                      <img src="https://boletos.vinosparvada.com/assets/img/BBVA.png" width = "10%" height = "10%" id="BBVA">
                      <img src="https://boletos.vinosparvada.com/assets/img/citibanamex.png" width = "10%" height = "10%" id="citibanamex">
                      <img src="https://boletos.vinosparvada.com/assets/img/hsbc.png" width = "10%" height = "10%" id="hsbc">
                      <img src="https://boletos.vinosparvada.com/assets/img/inbursa.png" width = "10%" height = "10%" id="inbursa">
                      <img src="https://boletos.vinosparvada.com/assets/img/invex.png" width = "10%" height = "10%" id="invex">
                      <img src="https://boletos.vinosparvada.com/assets/img/ixe.png" width = "10%" height = "10%" id="ixe">
                      <img src="https://boletos.vinosparvada.com/assets/img/santander.png" width = "10%" height = "10%" id="santander">
                      <img src="https://boletos.vinosparvada.com/assets/img/scotiabank.png" width = "10%" height = "10%" id="scotiabank">
                    </div>
                  <div class="form-group" id="pay-now">
                      <btn class="btn btn-default" id="pay-button" onclick="botonPagar(this)">Procesar pago</btn>
                  </div>
              </form>
          </div>
      </div>`);
    }  
    $.getScript("../assets/js/jquery.payform.min.js");
    $.getScript("../assets/js/script.js");

    const btnPagar = document.getElementById('pay-button');

    btnPagar.addEventListener('click', function() {
      // btnPagar.disabled = true;
      // btnPagar.textContent = 'Procesando pago...';
      if(pagarPresionado == true)
      {
        console.log("MENSAJE AMERICAN EXPRESS");
        btnPagar.disabled = true;
        btnPagar.textContent = 'Procesando pago...';
      }
      if(pagarPresionado == false)
      {
        btnPagar.textContent = 'Procesar pago';
      }
    });
  }
</script>

<style>
  /* @charset "US-ASCII"; */
  /* @import "http://fonts.googleapis.com/css?family=Lato:300,400,700";
  * {
      color: #444;
      font-family: Lato;
      font-size: 16px;
      font-weight: 300;
  } */

  /* body {
    float: left;
    margin: 0;
    padding: 0;
    width: 100%;
}
strong {
	font-weight: 700;
}
a {
    cursor: pointer;
    display: block;
    text-decoration: none;
} */

  /*estilos de forma pago openpay*/
  /* .openpay {
    float: right;
    height: 60px;
    margin: 10px 30px 0 0;
    width: 435px;
} */
  /* .openpay div.logo {
    background-image: url("https://public.openpay.mx/images/logos/openpay/logo_login.png");
    background-position: center;
    background-size: 65%;
    background-repeat: no-repeat;
    border-right: 1px solid #ccc;
    font-size: 12px;
    font-weight: 400;
    height: 45px;
    padding: 15px 20px 10px 0;
} */
  .modal-precios {
    display: none;
    /* Hidden by default */
    /*position: fixed; /* Stay in place */
    /*z-index: 1; /* Sit on top */
    padding-top: 100px;
    /* Location of the box */
    left: 0;
    top: 0;
    width: 100%;
    /* Full width */
    height: 100%;
    /* Full height */
    overflow: auto;
    /* Enable scroll if needed */
    background-color: rgb(0, 0, 0);
    /* Fallback color */
    background-color: rgba(0, 0, 0, 0.9);
    /* Black w/ opacity */
  }

  /* Modal Content (image) */
  .modal-content-precios {
    margin-top: 20%;
    margin: auto;
    display: block;
    width: 80%;
    max-width: 100%;
  }

  /* Caption of Modal Image */
  #caption-precios {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    height: 150px;
  }

  /* Add Animation */
  /*.modal-content, #caption {  
  -webkit-animation-name: zoom;
  -webkit-animation-duration: 0.6s;
  animation-name: zoom;
  animation-duration: 0.6s;
}*/

  @-webkit-keyframes zoom {
    from {
      -webkit-transform: scale(0)
    }

    to {
      -webkit-transform: scale(1)
    }
  }

  @keyframes zoom {
    from {
      transform: scale(0)
    }

    to {
      transform: scale(1)
    }
  }

  /* The Close Button */
  .close {
    position: fixed;
    /*bottom: 50%;*/
    top: 25%;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    transition: 0.3s;
  }

  .close:hover,
  .close:focus {
    color: #bbb;
    text-decoration: none;
    cursor: pointer;
  }

  /* 100% Image Width on Smaller Screens */
  @media only screen and (max-width: 700px) {
    .modal-content-precios {
      width: 100%;
    }
  }



.creditCardForm {
    max-width: 750px;
    /* background-color: #fff; */
    /*background-color: #939393; */
    margin: 1% auto;
    overflow: hidden;
    padding: 2px;
    color: #4c4e56;
}
.creditCardForm label {
    width: 100%;
    margin-bottom: 10px;
}
.creditCardForm .heading h1 {
    text-align: center;
    font-family: 'Open Sans', sans-serif;
    color: #4c4e56;
}
.creditCardForm .payment {
    float: left;
    font-size: 18px;
    padding: 10px 25px;
    margin-top: 20px;
    position: relative;
}
.creditCardForm .payment .form-group {
    float: left;
    margin-bottom: 15px;
}
.creditCardForm .payment .form-control {
    line-height: 40px;
    height: auto;
    padding: 0 16px;
}
.creditCardForm .owner {
    width: 63%;
    margin-right: 10px;
}
.creditCardForm .cvv {
    width: 35%;
}
.creditCardForm #card-number-field {
    width: 100%;
}
.creditCardForm #expiration-date {
    width: 49%;
}
.creditCardForm #credit_cards {
    width: 50%;
    margin-top: 25px;
    text-align: right;
}
.creditCardForm #pay-now {
    width: 100%;
    margin-top: 25px;
}
.creditCardForm .payment .btn {
    width: 100%;
    margin-top: 3px;
    font-size: 24px;
    background-color: #2ec4a5;
    color: white;
}
.creditCardForm .payment select {
    padding: 10px;
    margin-right: 15px;
}
.transparent {
    opacity: 0.2;
}
@media(max-width: 650px) {
    .creditCardForm .owner,
    .creditCardForm .cvv,
    .creditCardForm #expiration-date,
    .creditCardForm #credit_cards {
        width: 100%;
    }
    .creditCardForm #credit_cards {
        text-align: left;
    }
}
/*fin estilos forma pago openpay */
a.button {
    border-radius: 5px 5px 5px 5px;
    -webkit-border-radius: 5px 5px 5px 5px;
    -moz-border-radius: 5px 5px 5px 5px;
    text-align: center;
    font-size: 21px;
    font-weight: 400;
    padding: 12px 0;
    width: 100%;
    display: table;
    background: #E51F04;
    background: -moz-linear-gradient(top,  #E51F04 0%, #A60000 100%);
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#E51F04), color-stop(100%,#A60000));
    background: -webkit-linear-gradient(top,  #E51F04 0%,#A60000 100%);
    background: -o-linear-gradient(top,  #E51F04 0%,#A60000 100%);
    background: -ms-linear-gradient(top,  #E51F04 0%,#A60000 100%);
    background: linear-gradient(top,  #E51F04 0%,#A60000 100%);
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#E51F04', endColorstr='#A60000',GradientType=0 );
}
a.button i {
    margin-right: 10px;
}
a.button.disabled {
    background: none repeat scroll 0 0 #ccc;
    cursor: default;
}
.bkng-tb-cntnt {
    float: left;
    width: 800px;
}
.bkng-tb-cntnt a.button {
    color: #fff;
    float: right;
    font-size: 18px;
    padding: 5px 20px;
    width: auto;
}
.bkng-tb-cntnt a.button.o {
    background: none repeat scroll 0 0 rgba(0, 0, 0, 0);
    color: #e51f04;
    border: 1px solid #e51f04;
}
.bkng-tb-cntnt a.button i {
    color: #fff;
}
.bkng-tb-cntnt a.button.o i {
    color: #e51f04;
}
.bkng-tb-cntnt a.button.right i {
    float: right;
    margin: 2px 0 0 10px;
}
.bkng-tb-cntnt a.button.left {
    float: left;
}
.bkng-tb-cntnt a.button.disabled.o {
    border-color: #ccc;
    color: #ccc;
}
.bkng-tb-cntnt a.button.disabled.o i {
    color: #ccc;
}
.pymnts {
    float: left;
    width: 800px;
}
.pymnts * {
    float: left;
}

.sctn-row {
    margin-bottom: 35px;
    width: 800px;
}
.sctn-col {
    width: 375px;
}
.sctn-col.l {
    width: 425px;
}
.sctn-col input {
    border: 1px solid #ccc;
    font-size: 18px;
    line-height: 24px;
    padding: 10px 12px;
    width: 333px;
}
.sctn-col label {
    font-size: 24px;
    line-height: 24px;
    margin-bottom: 10px;
    width: 100%;
}
.sctn-col.x3 {
    width: 300px;
}
.sctn-col.x3.last {
    width: 200px;
}
.sctn-col.x3 input {
    width: 210px;
}
.sctn-col.x3 a {
    float: right;
}
.pymnts-sctn {
    width: 800px;
}
.pymnt-itm {
    margin: 0 0 3px;
    width: 800px;
}
.pymnt-itm h2 {
    background-color: #e9e9e9;
    font-size: 24px;
    line-height: 24px;
    margin: 0;
    padding: 28px 0 28px 20px;
    width: 780px;
}
.pymnt-itm.active h2 {
    background-color: #e51f04;
    color: #fff;
    cursor: default;
}
.pymnt-itm div.pymnt-cntnt {
    display: none;
}
.pymnt-itm.active div.pymnt-cntnt {
    background-color: #f7f7f7;
    display: block;
    padding: 0 0 30px;
    width: 100%;
}

.pymnt-cntnt div.sctn-row {
    margin: 20px 30px 0;
    width: 740px;
}
.pymnt-cntnt div.sctn-row div.sctn-col {
    width: 345px;
}
.pymnt-cntnt div.sctn-row div.sctn-col.l {
    width: 395px;
}
.pymnt-cntnt div.sctn-row div.sctn-col input {
    width: 303px;
}
.pymnt-cntnt div.sctn-row div.sctn-col.half {
    width: 155px;
}
.pymnt-cntnt div.sctn-row div.sctn-col.half.l {
    float: left;
    width: 190px;
}
.pymnt-cntnt div.sctn-row div.sctn-col.half input {
    width: 113px;
}
.pymnt-cntnt div.sctn-row div.sctn-col.cvv {
    background-image: url('https://boletos.vinosparvada.com/assets/img/logos/cvv.png');
    background-position: 156px center;
    background-repeat: no-repeat;
    padding-bottom: 30px;
}
.pymnt-cntnt div.sctn-row div.sctn-col.cvv div.sctn-col.half input {
    width: 110px;
}
.openpay {
    float: right;
    height: 60px;
    margin: 10px 30px 0 0;
    width: 435px;
}
.openpay div.logo {
    background-image: url("https://public.openpay.mx/images/logos/openpay/logo_login.png");
    background-position: left bottom;
    background-size: 65%;
    background-repeat: no-repeat;
    border-right: 1px solid #ccc;
    font-size: 12px;
    font-weight: 400;
    height: 45px;
    padding: 15px 20px 10px 0;
}
.openpay div.shield {
    background-image: url('https://boletos.vinosparvada.com/assets/img/logos/security.png');
    background-position: left bottom;
    background-repeat: no-repeat;
    font-size: 12px;
    font-weight: 400;
    margin-left: 20px;
    padding: 20px 0 0 40px;
    width: 200px;
}
.card-expl {
    float: left;
    height: 80px;
    margin: 20px 0;
    width: 800px;
}
.card-expl div {
    background-position: left 45px;
    background-repeat: no-repeat;
    height: 70px;
    padding-top: 10px;
}
.card-expl div.debit {
    background-image: url('https://boletos.vinosparvada.com/assets/img/logos/cards2.png');
    margin-left: 20px;
    width: 540px;
}
.card-expl div.credit {
    background-image: url('https://boletos.vinosparvada.com/assets/img/logos/cards1.png');
    border-right: 1px solid #ccc;
    margin-left: 30px;
    width: 209px;
}
.card-expl h4 {
    font-weight: 400;
    margin: 0;
}
</style><!-- <script src="/assets/js/jquery.min.js"></script> -->
<script src="https://boletos.vinosparvada.com/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="https://boletos.vinosparvada.com/assets/js/agency.js"></script>



<!--?xml version="1.0" encoding="UTF-8" ?-->



<iframe id="_op_data_r" scrolling="no" src="https://api.openpay.mx/logo.htm?m=203000&amp;s=8lPKrDJbODFaE02rWnF1dC09t0bTlgF6" width="1" height="1" frameborder="0">
	<img
		src="https://api.openpay.mx/logo.gif?m=203000&amp;s=8lPKrDJbODFaE02rWnF1dC09t0bTlgF6"
		width="1" height="1">
</iframe>



	<!--?xml version="1.0" encoding="UTF-8" ?-->

<iframe id="_op_data_antifraud" scrolling="no" src="https://api.openpay.mx/oa/logo.htm?m=m730u8lzas5f1xo7kuyw&amp;s=8lPKrDJbODFaE02rWnF1dC09t0bTlgF6" width="1" height="1" frameborder="0">

	<img src="https://api.openpay.mx/oa/logo.gif?m=m730u8lzas5f1xo7kuyw&amp;s=8lPKrDJbODFaE02rWnF1dC09t0bTlgF6"
		width="1" height="1">
</iframe>
</body></html>